   1               		.file	"action_tapping.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.debug_waiting_buffer,"ax",@progbits
  12               	debug_waiting_buffer:
  13               	.LFB13:
  14               		.file 1 "tmk_core/common/action_tapping.c"
   1:tmk_core/common/action_tapping.c **** #include <stdint.h>
   2:tmk_core/common/action_tapping.c **** #include <stdbool.h>
   3:tmk_core/common/action_tapping.c **** #include "action.h"
   4:tmk_core/common/action_tapping.c **** #include "action_layer.h"
   5:tmk_core/common/action_tapping.c **** #include "action_tapping.h"
   6:tmk_core/common/action_tapping.c **** #include "keycode.h"
   7:tmk_core/common/action_tapping.c **** #include "timer.h"
   8:tmk_core/common/action_tapping.c **** 
   9:tmk_core/common/action_tapping.c **** #ifdef DEBUG_ACTION
  10:tmk_core/common/action_tapping.c **** #    include "debug.h"
  11:tmk_core/common/action_tapping.c **** #else
  12:tmk_core/common/action_tapping.c **** #    include "nodebug.h"
  13:tmk_core/common/action_tapping.c **** #endif
  14:tmk_core/common/action_tapping.c **** 
  15:tmk_core/common/action_tapping.c **** #ifndef NO_ACTION_TAPPING
  16:tmk_core/common/action_tapping.c **** 
  17:tmk_core/common/action_tapping.c **** #    define IS_TAPPING() !IS_NOEVENT(tapping_key.event)
  18:tmk_core/common/action_tapping.c **** #    define IS_TAPPING_PRESSED() (IS_TAPPING() && tapping_key.event.pressed)
  19:tmk_core/common/action_tapping.c **** #    define IS_TAPPING_RELEASED() (IS_TAPPING() && !tapping_key.event.pressed)
  20:tmk_core/common/action_tapping.c **** #    define IS_TAPPING_KEY(k) (IS_TAPPING() && KEYEQ(tapping_key.event.key, (k)))
  21:tmk_core/common/action_tapping.c **** 
  22:tmk_core/common/action_tapping.c **** __attribute__((weak)) uint16_t get_tapping_term(uint16_t keycode, keyrecord_t *record) { return TAP
  23:tmk_core/common/action_tapping.c **** 
  24:tmk_core/common/action_tapping.c **** #    ifdef TAPPING_TERM_PER_KEY
  25:tmk_core/common/action_tapping.c **** #        define WITHIN_TAPPING_TERM(e) (TIMER_DIFF_16(e.time, tapping_key.event.time) < get_tapping
  26:tmk_core/common/action_tapping.c **** #    else
  27:tmk_core/common/action_tapping.c **** #        define WITHIN_TAPPING_TERM(e) (TIMER_DIFF_16(e.time, tapping_key.event.time) < TAPPING_TER
  28:tmk_core/common/action_tapping.c **** #    endif
  29:tmk_core/common/action_tapping.c **** 
  30:tmk_core/common/action_tapping.c **** #    ifdef TAPPING_FORCE_HOLD_PER_KEY
  31:tmk_core/common/action_tapping.c **** __attribute__((weak)) bool get_tapping_force_hold(uint16_t keycode, keyrecord_t *record) { return f
  32:tmk_core/common/action_tapping.c **** #    endif
  33:tmk_core/common/action_tapping.c **** 
  34:tmk_core/common/action_tapping.c **** #    ifdef PERMISSIVE_HOLD_PER_KEY
  35:tmk_core/common/action_tapping.c **** __attribute__((weak)) bool get_permissive_hold(uint16_t keycode, keyrecord_t *record) { return fals
  36:tmk_core/common/action_tapping.c **** #    endif
  37:tmk_core/common/action_tapping.c **** 
  38:tmk_core/common/action_tapping.c **** static keyrecord_t tapping_key                         = {};
  39:tmk_core/common/action_tapping.c **** static keyrecord_t waiting_buffer[WAITING_BUFFER_SIZE] = {};
  40:tmk_core/common/action_tapping.c **** static uint8_t     waiting_buffer_head                 = 0;
  41:tmk_core/common/action_tapping.c **** static uint8_t     waiting_buffer_tail                 = 0;
  42:tmk_core/common/action_tapping.c **** 
  43:tmk_core/common/action_tapping.c **** static bool process_tapping(keyrecord_t *record);
  44:tmk_core/common/action_tapping.c **** static bool waiting_buffer_enq(keyrecord_t record);
  45:tmk_core/common/action_tapping.c **** static void waiting_buffer_clear(void);
  46:tmk_core/common/action_tapping.c **** static bool waiting_buffer_typed(keyevent_t event);
  47:tmk_core/common/action_tapping.c **** static bool waiting_buffer_has_anykey_pressed(void);
  48:tmk_core/common/action_tapping.c **** static void waiting_buffer_scan_tap(void);
  49:tmk_core/common/action_tapping.c **** static void debug_tapping_key(void);
  50:tmk_core/common/action_tapping.c **** static void debug_waiting_buffer(void);
  51:tmk_core/common/action_tapping.c **** 
  52:tmk_core/common/action_tapping.c **** /** \brief Action Tapping Process
  53:tmk_core/common/action_tapping.c ****  *
  54:tmk_core/common/action_tapping.c ****  * FIXME: Needs doc
  55:tmk_core/common/action_tapping.c ****  */
  56:tmk_core/common/action_tapping.c **** void action_tapping_process(keyrecord_t record) {
  57:tmk_core/common/action_tapping.c ****     if (process_tapping(&record)) {
  58:tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
  59:tmk_core/common/action_tapping.c ****             debug("processed: ");
  60:tmk_core/common/action_tapping.c ****             debug_record(record);
  61:tmk_core/common/action_tapping.c ****             debug("\n");
  62:tmk_core/common/action_tapping.c ****         }
  63:tmk_core/common/action_tapping.c ****     } else {
  64:tmk_core/common/action_tapping.c ****         if (!waiting_buffer_enq(record)) {
  65:tmk_core/common/action_tapping.c ****             // clear all in case of overflow.
  66:tmk_core/common/action_tapping.c ****             debug("OVERFLOW: CLEAR ALL STATES\n");
  67:tmk_core/common/action_tapping.c ****             clear_keyboard();
  68:tmk_core/common/action_tapping.c ****             waiting_buffer_clear();
  69:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
  70:tmk_core/common/action_tapping.c ****         }
  71:tmk_core/common/action_tapping.c ****     }
  72:tmk_core/common/action_tapping.c **** 
  73:tmk_core/common/action_tapping.c ****     // process waiting_buffer
  74:tmk_core/common/action_tapping.c ****     if (!IS_NOEVENT(record.event) && waiting_buffer_head != waiting_buffer_tail) {
  75:tmk_core/common/action_tapping.c ****         debug("---- action_exec: process waiting_buffer -----\n");
  76:tmk_core/common/action_tapping.c ****     }
  77:tmk_core/common/action_tapping.c ****     for (; waiting_buffer_tail != waiting_buffer_head; waiting_buffer_tail = (waiting_buffer_tail +
  78:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
  79:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer[");
  80:tmk_core/common/action_tapping.c ****             debug_dec(waiting_buffer_tail);
  81:tmk_core/common/action_tapping.c ****             debug("] = ");
  82:tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]);
  83:tmk_core/common/action_tapping.c ****             debug("\n\n");
  84:tmk_core/common/action_tapping.c ****         } else {
  85:tmk_core/common/action_tapping.c ****             break;
  86:tmk_core/common/action_tapping.c ****         }
  87:tmk_core/common/action_tapping.c ****     }
  88:tmk_core/common/action_tapping.c ****     if (!IS_NOEVENT(record.event)) {
  89:tmk_core/common/action_tapping.c ****         debug("\n");
  90:tmk_core/common/action_tapping.c ****     }
  91:tmk_core/common/action_tapping.c **** }
  92:tmk_core/common/action_tapping.c **** 
  93:tmk_core/common/action_tapping.c **** /** \brief Tapping
  94:tmk_core/common/action_tapping.c ****  *
  95:tmk_core/common/action_tapping.c ****  * Rule: Tap key is typed(pressed and released) within TAPPING_TERM.
  96:tmk_core/common/action_tapping.c ****  *       (without interfering by typing other key)
  97:tmk_core/common/action_tapping.c ****  */
  98:tmk_core/common/action_tapping.c **** /* return true when key event is processed or consumed. */
  99:tmk_core/common/action_tapping.c **** bool process_tapping(keyrecord_t *keyp) {
 100:tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
 101:tmk_core/common/action_tapping.c **** 
 102:tmk_core/common/action_tapping.c ****     // if tapping
 103:tmk_core/common/action_tapping.c ****     if (IS_TAPPING_PRESSED()) {
 104:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 105:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 106:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 107:tmk_core/common/action_tapping.c ****                     // first tap!
 108:tmk_core/common/action_tapping.c ****                     debug("Tapping: First tap(0->1).\n");
 109:tmk_core/common/action_tapping.c ****                     tapping_key.tap.count = 1;
 110:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 111:tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 112:tmk_core/common/action_tapping.c **** 
 113:tmk_core/common/action_tapping.c ****                     // copy tapping state
 114:tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 115:tmk_core/common/action_tapping.c ****                     // enqueue
 116:tmk_core/common/action_tapping.c ****                     return false;
 117:tmk_core/common/action_tapping.c ****                 }
 118:tmk_core/common/action_tapping.c ****                 /* Process a key typed within TAPPING_TERM
 119:tmk_core/common/action_tapping.c ****                  * This can register the key before settlement of tapping,
 120:tmk_core/common/action_tapping.c ****                  * useful for long TAPPING_TERM but may prevent fast typing.
 121:tmk_core/common/action_tapping.c ****                  */
 122:tmk_core/common/action_tapping.c **** #    if defined(TAPPING_TERM_PER_KEY) || (TAPPING_TERM >= 500) || defined(PERMISSIVE_HOLD) || defin
 123:tmk_core/common/action_tapping.c ****                 else if (
 124:tmk_core/common/action_tapping.c **** #        ifdef TAPPING_TERM_PER_KEY
 125:tmk_core/common/action_tapping.c ****                     (get_tapping_term(get_event_keycode(tapping_key.event, false), keyp) >= 500) &&
 126:tmk_core/common/action_tapping.c **** #        endif
 127:tmk_core/common/action_tapping.c **** #        ifdef PERMISSIVE_HOLD_PER_KEY
 128:tmk_core/common/action_tapping.c ****                     !get_permissive_hold(get_event_keycode(tapping_key.event, false), keyp) &&
 129:tmk_core/common/action_tapping.c **** #        endif
 130:tmk_core/common/action_tapping.c ****                     IS_RELEASED(event) && waiting_buffer_typed(event)) {
 131:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 132:tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 133:tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 134:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 135:tmk_core/common/action_tapping.c ****                     // enqueue
 136:tmk_core/common/action_tapping.c ****                     return false;
 137:tmk_core/common/action_tapping.c ****                 }
 138:tmk_core/common/action_tapping.c **** #    endif
 139:tmk_core/common/action_tapping.c ****                 /* Process release event of a key pressed before tapping starts
 140:tmk_core/common/action_tapping.c ****                  * Without this unexpected repeating will occur with having fast repeating setting
 141:tmk_core/common/action_tapping.c ****                  * https://github.com/tmk/tmk_keyboard/issues/60
 142:tmk_core/common/action_tapping.c ****                  */
 143:tmk_core/common/action_tapping.c ****                 else if (IS_RELEASED(event) && !waiting_buffer_typed(event)) {
 144:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 145:tmk_core/common/action_tapping.c ****                     action_t action = layer_switch_get_action(event.key);
 146:tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 147:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 148:tmk_core/common/action_tapping.c ****                         case ACT_RMODS:
 149:tmk_core/common/action_tapping.c ****                             if (action.key.mods && !action.key.code) return false;
 150:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 151:tmk_core/common/action_tapping.c ****                             break;
 152:tmk_core/common/action_tapping.c ****                         case ACT_LMODS_TAP:
 153:tmk_core/common/action_tapping.c ****                         case ACT_RMODS_TAP:
 154:tmk_core/common/action_tapping.c ****                             if (action.key.mods && keyp->tap.count == 0) return false;
 155:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 156:tmk_core/common/action_tapping.c ****                             break;
 157:tmk_core/common/action_tapping.c ****                     }
 158:tmk_core/common/action_tapping.c ****                     // Release of key should be process immediately.
 159:tmk_core/common/action_tapping.c ****                     debug("Tapping: release event of a key pressed before tapping\n");
 160:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 161:tmk_core/common/action_tapping.c ****                     return true;
 162:tmk_core/common/action_tapping.c ****                 } else {
 163:tmk_core/common/action_tapping.c ****                     // set interrupted flag when other key preesed during tapping
 164:tmk_core/common/action_tapping.c ****                     if (event.pressed) {
 165:tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 166:tmk_core/common/action_tapping.c ****                     }
 167:tmk_core/common/action_tapping.c ****                     // enqueue
 168:tmk_core/common/action_tapping.c ****                     return false;
 169:tmk_core/common/action_tapping.c ****                 }
 170:tmk_core/common/action_tapping.c ****             }
 171:tmk_core/common/action_tapping.c ****             // tap_count > 0
 172:tmk_core/common/action_tapping.c ****             else {
 173:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 174:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release(");
 175:tmk_core/common/action_tapping.c ****                     debug_dec(tapping_key.tap.count);
 176:tmk_core/common/action_tapping.c ****                     debug(")\n");
 177:tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 178:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 179:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 180:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 181:tmk_core/common/action_tapping.c ****                     return true;
 182:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key) && event.pressed) {
 183:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 184:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 185:tmk_core/common/action_tapping.c ****                         // unregister key
 186:tmk_core/common/action_tapping.c ****                         process_record(&(keyrecord_t){.tap = tapping_key.tap, .event.key = tapping_
 187:tmk_core/common/action_tapping.c ****                     } else {
 188:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start while last tap(1).\n");
 189:tmk_core/common/action_tapping.c ****                     }
 190:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 191:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 192:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 193:tmk_core/common/action_tapping.c ****                     return true;
 194:tmk_core/common/action_tapping.c ****                 } else {
 195:tmk_core/common/action_tapping.c ****                     if (!IS_NOEVENT(event)) {
 196:tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last tap(>0).\n");
 197:tmk_core/common/action_tapping.c ****                     }
 198:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 199:tmk_core/common/action_tapping.c ****                     return true;
 200:tmk_core/common/action_tapping.c ****                 }
 201:tmk_core/common/action_tapping.c ****             }
 202:tmk_core/common/action_tapping.c ****         }
 203:tmk_core/common/action_tapping.c ****         // after TAPPING_TERM
 204:tmk_core/common/action_tapping.c ****         else {
 205:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 206:tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 207:tmk_core/common/action_tapping.c ****                 debug_event(event);
 208:tmk_core/common/action_tapping.c ****                 debug("\n");
 209:tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 210:tmk_core/common/action_tapping.c ****                 tapping_key = (keyrecord_t){};
 211:tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 212:tmk_core/common/action_tapping.c ****                 return false;
 213:tmk_core/common/action_tapping.c ****             } else {
 214:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 215:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 216:tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 217:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 218:tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 219:tmk_core/common/action_tapping.c ****                     return true;
 220:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key) && event.pressed) {
 221:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 222:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 223:tmk_core/common/action_tapping.c ****                         // unregister key
 224:tmk_core/common/action_tapping.c ****                         process_record(&(keyrecord_t){.tap = tapping_key.tap, .event.key = tapping_
 225:tmk_core/common/action_tapping.c ****                     } else {
 226:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start while last timeout tap(1).\n");
 227:tmk_core/common/action_tapping.c ****                     }
 228:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 229:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 230:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 231:tmk_core/common/action_tapping.c ****                     return true;
 232:tmk_core/common/action_tapping.c ****                 } else {
 233:tmk_core/common/action_tapping.c ****                     if (!IS_NOEVENT(event)) {
 234:tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last timeout tap(>0).\n");
 235:tmk_core/common/action_tapping.c ****                     }
 236:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 237:tmk_core/common/action_tapping.c ****                     return true;
 238:tmk_core/common/action_tapping.c ****                 }
 239:tmk_core/common/action_tapping.c ****             }
 240:tmk_core/common/action_tapping.c ****         }
 241:tmk_core/common/action_tapping.c ****     } else if (IS_TAPPING_RELEASED()) {
 242:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 243:tmk_core/common/action_tapping.c ****             if (event.pressed) {
 244:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 245:tmk_core/common/action_tapping.c **** //#    ifndef TAPPING_FORCE_HOLD
 246:tmk_core/common/action_tapping.c **** #    if !defined(TAPPING_FORCE_HOLD) || defined(TAPPING_FORCE_HOLD_PER_KEY)
 247:tmk_core/common/action_tapping.c ****                     if (
 248:tmk_core/common/action_tapping.c **** #        ifdef TAPPING_FORCE_HOLD_PER_KEY
 249:tmk_core/common/action_tapping.c ****                         !get_tapping_force_hold(get_event_keycode(tapping_key.event, false), keyp) 
 250:tmk_core/common/action_tapping.c **** #        endif
 251:tmk_core/common/action_tapping.c ****                         !tapping_key.tap.interrupted && tapping_key.tap.count > 0) {
 252:tmk_core/common/action_tapping.c ****                         // sequential tap.
 253:tmk_core/common/action_tapping.c ****                         keyp->tap = tapping_key.tap;
 254:tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 255:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press(");
 256:tmk_core/common/action_tapping.c ****                         debug_dec(keyp->tap.count);
 257:tmk_core/common/action_tapping.c ****                         debug(")\n");
 258:tmk_core/common/action_tapping.c ****                         process_record(keyp);
 259:tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 260:tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 261:tmk_core/common/action_tapping.c ****                         return true;
 262:tmk_core/common/action_tapping.c ****                     }
 263:tmk_core/common/action_tapping.c **** #    endif
 264:tmk_core/common/action_tapping.c ****                     // FIX: start new tap again
 265:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 266:tmk_core/common/action_tapping.c ****                     return true;
 267:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 268:tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 269:tmk_core/common/action_tapping.c ****                     debug("Tapping: Start with interfering other tap.\n");
 270:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 271:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 272:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 273:tmk_core/common/action_tapping.c ****                     return true;
 274:tmk_core/common/action_tapping.c ****                 } else {
 275:tmk_core/common/action_tapping.c ****                     // should none in buffer
 276:tmk_core/common/action_tapping.c ****                     // FIX: interrupted when other key is pressed
 277:tmk_core/common/action_tapping.c ****                     tapping_key.tap.interrupted = true;
 278:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 279:tmk_core/common/action_tapping.c ****                     return true;
 280:tmk_core/common/action_tapping.c ****                 }
 281:tmk_core/common/action_tapping.c ****             } else {
 282:tmk_core/common/action_tapping.c ****                 if (!IS_NOEVENT(event)) debug("Tapping: other key just after tap.\n");
 283:tmk_core/common/action_tapping.c ****                 process_record(keyp);
 284:tmk_core/common/action_tapping.c ****                 return true;
 285:tmk_core/common/action_tapping.c ****             }
 286:tmk_core/common/action_tapping.c ****         } else {
 287:tmk_core/common/action_tapping.c ****             // FIX: process_action here?
 288:tmk_core/common/action_tapping.c ****             // timeout. no sequential tap.
 289:tmk_core/common/action_tapping.c ****             debug("Tapping: End(Timeout after releasing last tap): ");
 290:tmk_core/common/action_tapping.c ****             debug_event(event);
 291:tmk_core/common/action_tapping.c ****             debug("\n");
 292:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 293:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 294:tmk_core/common/action_tapping.c ****             return false;
 295:tmk_core/common/action_tapping.c ****         }
 296:tmk_core/common/action_tapping.c ****     }
 297:tmk_core/common/action_tapping.c ****     // not tapping state
 298:tmk_core/common/action_tapping.c ****     else {
 299:tmk_core/common/action_tapping.c ****         if (event.pressed && is_tap_key(event.key)) {
 300:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 301:tmk_core/common/action_tapping.c ****             tapping_key = *keyp;
 302:tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 303:tmk_core/common/action_tapping.c ****             waiting_buffer_scan_tap();
 304:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 305:tmk_core/common/action_tapping.c ****             return true;
 306:tmk_core/common/action_tapping.c ****         } else {
 307:tmk_core/common/action_tapping.c ****             process_record(keyp);
 308:tmk_core/common/action_tapping.c ****             return true;
 309:tmk_core/common/action_tapping.c ****         }
 310:tmk_core/common/action_tapping.c ****     }
 311:tmk_core/common/action_tapping.c **** }
 312:tmk_core/common/action_tapping.c **** 
 313:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer enq
 314:tmk_core/common/action_tapping.c ****  *
 315:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 316:tmk_core/common/action_tapping.c ****  */
 317:tmk_core/common/action_tapping.c **** bool waiting_buffer_enq(keyrecord_t record) {
 318:tmk_core/common/action_tapping.c ****     if (IS_NOEVENT(record.event)) {
 319:tmk_core/common/action_tapping.c ****         return true;
 320:tmk_core/common/action_tapping.c ****     }
 321:tmk_core/common/action_tapping.c **** 
 322:tmk_core/common/action_tapping.c ****     if ((waiting_buffer_head + 1) % WAITING_BUFFER_SIZE == waiting_buffer_tail) {
 323:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 324:tmk_core/common/action_tapping.c ****         return false;
 325:tmk_core/common/action_tapping.c ****     }
 326:tmk_core/common/action_tapping.c **** 
 327:tmk_core/common/action_tapping.c ****     waiting_buffer[waiting_buffer_head] = record;
 328:tmk_core/common/action_tapping.c ****     waiting_buffer_head                 = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 329:tmk_core/common/action_tapping.c **** 
 330:tmk_core/common/action_tapping.c ****     debug("waiting_buffer_enq: ");
 331:tmk_core/common/action_tapping.c ****     debug_waiting_buffer();
 332:tmk_core/common/action_tapping.c ****     return true;
 333:tmk_core/common/action_tapping.c **** }
 334:tmk_core/common/action_tapping.c **** 
 335:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer clear
 336:tmk_core/common/action_tapping.c ****  *
 337:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 338:tmk_core/common/action_tapping.c ****  */
 339:tmk_core/common/action_tapping.c **** void waiting_buffer_clear(void) {
 340:tmk_core/common/action_tapping.c ****     waiting_buffer_head = 0;
 341:tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 342:tmk_core/common/action_tapping.c **** }
 343:tmk_core/common/action_tapping.c **** 
 344:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer typed
 345:tmk_core/common/action_tapping.c ****  *
 346:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 347:tmk_core/common/action_tapping.c ****  */
 348:tmk_core/common/action_tapping.c **** bool waiting_buffer_typed(keyevent_t event) {
 349:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 350:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 351:tmk_core/common/action_tapping.c ****             return true;
 352:tmk_core/common/action_tapping.c ****         }
 353:tmk_core/common/action_tapping.c ****     }
 354:tmk_core/common/action_tapping.c ****     return false;
 355:tmk_core/common/action_tapping.c **** }
 356:tmk_core/common/action_tapping.c **** 
 357:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer has anykey pressed
 358:tmk_core/common/action_tapping.c ****  *
 359:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 360:tmk_core/common/action_tapping.c ****  */
 361:tmk_core/common/action_tapping.c **** __attribute__((unused)) bool waiting_buffer_has_anykey_pressed(void) {
 362:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 363:tmk_core/common/action_tapping.c ****         if (waiting_buffer[i].event.pressed) return true;
 364:tmk_core/common/action_tapping.c ****     }
 365:tmk_core/common/action_tapping.c ****     return false;
 366:tmk_core/common/action_tapping.c **** }
 367:tmk_core/common/action_tapping.c **** 
 368:tmk_core/common/action_tapping.c **** /** \brief Scan buffer for tapping
 369:tmk_core/common/action_tapping.c ****  *
 370:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 371:tmk_core/common/action_tapping.c ****  */
 372:tmk_core/common/action_tapping.c **** void waiting_buffer_scan_tap(void) {
 373:tmk_core/common/action_tapping.c ****     // tapping already is settled
 374:tmk_core/common/action_tapping.c ****     if (tapping_key.tap.count > 0) return;
 375:tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 376:tmk_core/common/action_tapping.c ****     if (!tapping_key.event.pressed) return;
 377:tmk_core/common/action_tapping.c **** 
 378:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 379:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 380:tmk_core/common/action_tapping.c ****             tapping_key.tap.count       = 1;
 381:tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 382:tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 383:tmk_core/common/action_tapping.c **** 
 384:tmk_core/common/action_tapping.c ****             debug("waiting_buffer_scan_tap: found at [");
 385:tmk_core/common/action_tapping.c ****             debug_dec(i);
 386:tmk_core/common/action_tapping.c ****             debug("]\n");
 387:tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 388:tmk_core/common/action_tapping.c ****             return;
 389:tmk_core/common/action_tapping.c ****         }
 390:tmk_core/common/action_tapping.c ****     }
 391:tmk_core/common/action_tapping.c **** }
 392:tmk_core/common/action_tapping.c **** 
 393:tmk_core/common/action_tapping.c **** /** \brief Tapping key debug print
 394:tmk_core/common/action_tapping.c ****  *
 395:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 396:tmk_core/common/action_tapping.c ****  */
 397:tmk_core/common/action_tapping.c **** static void debug_tapping_key(void) {
 398:tmk_core/common/action_tapping.c ****     debug("TAPPING_KEY=");
 399:tmk_core/common/action_tapping.c ****     debug_record(tapping_key);
 400:tmk_core/common/action_tapping.c ****     debug("\n");
 401:tmk_core/common/action_tapping.c **** }
 402:tmk_core/common/action_tapping.c **** 
 403:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer debug print
 404:tmk_core/common/action_tapping.c ****  *
 405:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 406:tmk_core/common/action_tapping.c ****  */
 407:tmk_core/common/action_tapping.c **** static void debug_waiting_buffer(void) {
  15               		.loc 1 407 40 view -0
  16               		.cfi_startproc
  17 0000 1F93      		push r17
  18               	.LCFI0:
  19               		.cfi_def_cfa_offset 3
  20               		.cfi_offset 17, -2
  21 0002 CF93      		push r28
  22               	.LCFI1:
  23               		.cfi_def_cfa_offset 4
  24               		.cfi_offset 28, -3
  25 0004 DF93      		push r29
  26               	.LCFI2:
  27               		.cfi_def_cfa_offset 5
  28               		.cfi_offset 29, -4
  29               	/* prologue: function */
  30               	/* frame size = 0 */
  31               	/* stack size = 3 */
  32               	.L__stack_usage = 3
 408:tmk_core/common/action_tapping.c ****     debug("{ ");
  33               		.loc 1 408 16 view .LVU1
 409:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  34               		.loc 1 409 5 view .LVU2
  35               	.LBB3:
  36               		.loc 1 409 10 view .LVU3
  37               		.loc 1 409 18 is_stmt 0 view .LVU4
  38 0006 C091 0000 		lds r28,waiting_buffer_tail
  39               	.LVL0:
 410:tmk_core/common/action_tapping.c ****         debug("[");
 411:tmk_core/common/action_tapping.c ****         debug_dec(i);
 412:tmk_core/common/action_tapping.c ****         debug("]=");
 413:tmk_core/common/action_tapping.c ****         debug_record(waiting_buffer[i]);
  40               		.loc 1 413 9 view .LVU5
  41 000a 16E0      		ldi r17,lo8(6)
  42               	.LVL1:
  43               	.L2:
 409:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  44               		.loc 1 409 43 is_stmt 1 discriminator 1 view .LVU6
 409:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  45               		.loc 1 409 5 is_stmt 0 discriminator 1 view .LVU7
  46 000c 8091 0000 		lds r24,waiting_buffer_head
  47 0010 8C13      		cpse r24,r28
  48 0012 00C0      		rjmp .L3
  49               	/* epilogue start */
  50               	.LBE3:
 414:tmk_core/common/action_tapping.c ****         debug(" ");
 415:tmk_core/common/action_tapping.c ****     }
 416:tmk_core/common/action_tapping.c ****     debug("}\n");
 417:tmk_core/common/action_tapping.c **** }
  51               		.loc 1 417 1 view .LVU8
  52 0014 DF91      		pop r29
  53 0016 CF91      		pop r28
  54               	.LVL2:
  55               		.loc 1 417 1 view .LVU9
  56 0018 1F91      		pop r17
  57 001a 0895      		ret
  58               	.LVL3:
  59               	.L3:
  60               	.LBB4:
 410:tmk_core/common/action_tapping.c ****         debug("[");
  61               		.loc 1 410 19 is_stmt 1 discriminator 3 view .LVU10
 411:tmk_core/common/action_tapping.c ****         debug("]=");
  62               		.loc 1 411 21 discriminator 3 view .LVU11
 412:tmk_core/common/action_tapping.c ****         debug_record(waiting_buffer[i]);
  63               		.loc 1 412 20 discriminator 3 view .LVU12
 413:tmk_core/common/action_tapping.c ****         debug(" ");
  64               		.loc 1 413 9 discriminator 3 view .LVU13
  65 001c D0E0      		ldi r29,0
  66 001e 1C9F      		mul r17,r28
  67 0020 F001      		movw r30,r0
  68 0022 1D9F      		mul r17,r29
  69 0024 F00D      		add r31,r0
  70 0026 1124      		clr __zero_reg__
  71 0028 E050      		subi r30,lo8(-(waiting_buffer))
  72 002a F040      		sbci r31,hi8(-(waiting_buffer))
  73 002c 4081      		ld r20,Z
  74 002e 5181      		ldd r21,Z+1
  75 0030 6281      		ldd r22,Z+2
  76 0032 7381      		ldd r23,Z+3
  77 0034 8481      		ldd r24,Z+4
  78 0036 9581      		ldd r25,Z+5
  79 0038 0E94 0000 		call debug_record
  80               	.LVL4:
 414:tmk_core/common/action_tapping.c ****     }
  81               		.loc 1 414 19 discriminator 3 view .LVU14
 409:tmk_core/common/action_tapping.c ****         debug("[");
  82               		.loc 1 409 69 discriminator 3 view .LVU15
 409:tmk_core/common/action_tapping.c ****         debug("[");
  83               		.loc 1 409 76 is_stmt 0 discriminator 3 view .LVU16
  84 003c 2196      		adiw r28,1
  85               	.LVL5:
 409:tmk_core/common/action_tapping.c ****         debug("[");
  86               		.loc 1 409 71 discriminator 3 view .LVU17
  87 003e C770      		andi r28,lo8(7)
 409:tmk_core/common/action_tapping.c ****         debug("[");
  88               		.loc 1 409 71 discriminator 3 view .LVU18
  89 0040 00C0      		rjmp .L2
  90               	.LBE4:
  91               		.cfi_endproc
  92               	.LFE13:
  94               		.section	.text.debug_tapping_key,"ax",@progbits
  96               	debug_tapping_key:
  97               	.LFB12:
 397:tmk_core/common/action_tapping.c ****     debug("TAPPING_KEY=");
  98               		.loc 1 397 37 is_stmt 1 view -0
  99               		.cfi_startproc
 100               	/* prologue: function */
 101               	/* frame size = 0 */
 102               	/* stack size = 0 */
 103               	.L__stack_usage = 0
 398:tmk_core/common/action_tapping.c ****     debug_record(tapping_key);
 104               		.loc 1 398 26 view .LVU20
 399:tmk_core/common/action_tapping.c ****     debug("\n");
 105               		.loc 1 399 5 view .LVU21
 106 0000 4091 0000 		lds r20,tapping_key
 107 0004 5091 0000 		lds r21,tapping_key+1
 108 0008 6091 0000 		lds r22,tapping_key+2
 109 000c 7091 0000 		lds r23,tapping_key+3
 110 0010 8091 0000 		lds r24,tapping_key+4
 111 0014 9091 0000 		lds r25,tapping_key+5
 112 0018 0C94 0000 		jmp debug_record
 113               	.LVL6:
 114               		.cfi_endproc
 115               	.LFE12:
 117               		.section	.text.waiting_buffer_typed.isra.1,"ax",@progbits
 119               	waiting_buffer_typed.isra.1:
 120               	.LFB15:
 348:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 121               		.loc 1 348 6 view -0
 122               		.cfi_startproc
 123               	/* prologue: function */
 124               	/* frame size = 0 */
 125               	/* stack size = 0 */
 126               	.L__stack_usage = 0
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 127               		.loc 1 349 5 view .LVU23
 128               	.LBB5:
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 129               		.loc 1 349 10 view .LVU24
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 130               		.loc 1 349 18 is_stmt 0 view .LVU25
 131 0000 2091 0000 		lds r18,waiting_buffer_tail
 132               	.LVL7:
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 133               		.loc 1 349 45 view .LVU26
 134 0004 9091 0000 		lds r25,waiting_buffer_head
 350:tmk_core/common/action_tapping.c ****             return true;
 135               		.loc 1 350 13 view .LVU27
 136 0008 56E0      		ldi r21,lo8(6)
 137               	.LVL8:
 138               	.L6:
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 139               		.loc 1 349 43 is_stmt 1 view .LVU28
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 140               		.loc 1 349 5 is_stmt 0 view .LVU29
 141 000a 2913      		cpse r18,r25
 142 000c 00C0      		rjmp .L9
 143               	.LBE5:
 354:tmk_core/common/action_tapping.c **** }
 144               		.loc 1 354 12 view .LVU30
 145 000e 80E0      		ldi r24,0
 146 0010 0895      		ret
 147               	.L9:
 148               	.LBB6:
 350:tmk_core/common/action_tapping.c ****             return true;
 149               		.loc 1 350 9 is_stmt 1 view .LVU31
 350:tmk_core/common/action_tapping.c ****             return true;
 150               		.loc 1 350 13 is_stmt 0 view .LVU32
 151 0012 30E0      		ldi r19,0
 152 0014 529F      		mul r21,r18
 153 0016 F001      		movw r30,r0
 154 0018 539F      		mul r21,r19
 155 001a F00D      		add r31,r0
 156 001c 1124      		clr __zero_reg__
 157 001e E050      		subi r30,lo8(-(waiting_buffer))
 158 0020 F040      		sbci r31,hi8(-(waiting_buffer))
 350:tmk_core/common/action_tapping.c ****             return true;
 159               		.loc 1 350 12 view .LVU33
 160 0022 7181      		ldd r23,Z+1
 161 0024 7613      		cpse r23,r22
 162 0026 00C0      		rjmp .L7
 350:tmk_core/common/action_tapping.c ****             return true;
 163               		.loc 1 350 13 view .LVU34
 164 0028 7081      		ld r23,Z
 165 002a 7813      		cpse r23,r24
 166 002c 00C0      		rjmp .L7
 350:tmk_core/common/action_tapping.c ****             return true;
 167               		.loc 1 350 59 view .LVU35
 168 002e 7281      		ldd r23,Z+2
 169 0030 7413      		cpse r23,r20
 170 0032 00C0      		rjmp .L10
 171               	.L7:
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 172               		.loc 1 349 69 is_stmt 1 view .LVU36
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 173               		.loc 1 349 76 is_stmt 0 view .LVU37
 174 0034 2F5F      		subi r18,-1
 175 0036 3F4F      		sbci r19,-1
 176               	.LVL9:
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 177               		.loc 1 349 71 view .LVU38
 178 0038 2770      		andi r18,lo8(7)
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed != waiting_buffer[i].eve
 179               		.loc 1 349 71 view .LVU39
 180 003a 00C0      		rjmp .L6
 181               	.LVL10:
 182               	.L10:
 351:tmk_core/common/action_tapping.c ****         }
 183               		.loc 1 351 20 view .LVU40
 184 003c 81E0      		ldi r24,lo8(1)
 185               	/* epilogue start */
 186               	.LBE6:
 355:tmk_core/common/action_tapping.c **** 
 187               		.loc 1 355 1 view .LVU41
 188 003e 0895      		ret
 189               		.cfi_endproc
 190               	.LFE15:
 192               		.section	.text.waiting_buffer_scan_tap,"ax",@progbits
 194               	waiting_buffer_scan_tap:
 195               	.LFB11:
 372:tmk_core/common/action_tapping.c ****     // tapping already is settled
 196               		.loc 1 372 36 is_stmt 1 view -0
 197               		.cfi_startproc
 198 0000 1F93      		push r17
 199               	.LCFI3:
 200               		.cfi_def_cfa_offset 3
 201               		.cfi_offset 17, -2
 202 0002 CF93      		push r28
 203               	.LCFI4:
 204               		.cfi_def_cfa_offset 4
 205               		.cfi_offset 28, -3
 206 0004 DF93      		push r29
 207               	.LCFI5:
 208               		.cfi_def_cfa_offset 5
 209               		.cfi_offset 29, -4
 210               	/* prologue: function */
 211               	/* frame size = 0 */
 212               	/* stack size = 3 */
 213               	.L__stack_usage = 3
 374:tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 214               		.loc 1 374 5 view .LVU43
 374:tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 215               		.loc 1 374 31 is_stmt 0 view .LVU44
 216 0006 8091 0000 		lds r24,tapping_key+5
 217 000a 807F      		andi r24,lo8(-16)
 374:tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 218               		.loc 1 374 8 view .LVU45
 219 000c 01F4      		brne .L11
 376:tmk_core/common/action_tapping.c **** 
 220               		.loc 1 376 5 is_stmt 1 view .LVU46
 376:tmk_core/common/action_tapping.c **** 
 221               		.loc 1 376 8 is_stmt 0 view .LVU47
 222 000e 8091 0000 		lds r24,tapping_key+2
 223 0012 8823      		tst r24
 224 0014 01F0      		breq .L11
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 225               		.loc 1 378 5 is_stmt 1 view .LVU48
 226               	.LBB10:
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 227               		.loc 1 378 10 view .LVU49
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 228               		.loc 1 378 18 is_stmt 0 view .LVU50
 229 0016 8091 0000 		lds r24,waiting_buffer_tail
 230               	.LVL11:
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 231               		.loc 1 378 45 view .LVU51
 232 001a C091 0000 		lds r28,waiting_buffer_head
 379:tmk_core/common/action_tapping.c ****             tapping_key.tap.count       = 1;
 233               		.loc 1 379 13 view .LVU52
 234 001e 6091 0000 		lds r22,tapping_key
 235 0022 7091 0000 		lds r23,tapping_key+1
 236 0026 A091 0000 		lds r26,tapping_key+3
 237 002a B091 0000 		lds r27,tapping_key+3+1
 238 002e D62F      		mov r29,r22
 239 0030 D723      		and r29,r23
 240 0032 16E0      		ldi r17,lo8(6)
 241               	.LVL12:
 242               	.L13:
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 243               		.loc 1 378 43 is_stmt 1 discriminator 1 view .LVU53
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 244               		.loc 1 378 5 is_stmt 0 discriminator 1 view .LVU54
 245 0034 C813      		cpse r28,r24
 246 0036 00C0      		rjmp .L16
 247               	.LVL13:
 248               	.L11:
 249               	/* epilogue start */
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 250               		.loc 1 378 5 discriminator 1 view .LVU55
 251               	.LBE10:
 391:tmk_core/common/action_tapping.c **** 
 252               		.loc 1 391 1 view .LVU56
 253 0038 DF91      		pop r29
 254 003a CF91      		pop r28
 255 003c 1F91      		pop r17
 256 003e 0895      		ret
 257               	.LVL14:
 258               	.L16:
 259               	.LBB13:
 379:tmk_core/common/action_tapping.c ****             tapping_key.tap.count       = 1;
 260               		.loc 1 379 9 is_stmt 1 view .LVU57
 261               	.LBB11:
 262               	.LBI11:
 263               		.file 2 "tmk_core/common/keyboard.h"
   1:tmk_core/common/keyboard.h **** /*
   2:tmk_core/common/keyboard.h **** Copyright 2011,2012,2013 Jun Wako <wakojun@gmail.com>
   3:tmk_core/common/keyboard.h **** 
   4:tmk_core/common/keyboard.h **** This program is free software: you can redistribute it and/or modify
   5:tmk_core/common/keyboard.h **** it under the terms of the GNU General Public License as published by
   6:tmk_core/common/keyboard.h **** the Free Software Foundation, either version 2 of the License, or
   7:tmk_core/common/keyboard.h **** (at your option) any later version.
   8:tmk_core/common/keyboard.h **** 
   9:tmk_core/common/keyboard.h **** This program is distributed in the hope that it will be useful,
  10:tmk_core/common/keyboard.h **** but WITHOUT ANY WARRANTY; without even the implied warranty of
  11:tmk_core/common/keyboard.h **** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  12:tmk_core/common/keyboard.h **** GNU General Public License for more details.
  13:tmk_core/common/keyboard.h **** 
  14:tmk_core/common/keyboard.h **** You should have received a copy of the GNU General Public License
  15:tmk_core/common/keyboard.h **** along with this program.  If not, see <http://www.gnu.org/licenses/>.
  16:tmk_core/common/keyboard.h **** */
  17:tmk_core/common/keyboard.h **** 
  18:tmk_core/common/keyboard.h **** #ifndef KEYBOARD_H
  19:tmk_core/common/keyboard.h **** #define KEYBOARD_H
  20:tmk_core/common/keyboard.h **** 
  21:tmk_core/common/keyboard.h **** #include <stdbool.h>
  22:tmk_core/common/keyboard.h **** #include <stdint.h>
  23:tmk_core/common/keyboard.h **** 
  24:tmk_core/common/keyboard.h **** #ifdef __cplusplus
  25:tmk_core/common/keyboard.h **** extern "C" {
  26:tmk_core/common/keyboard.h **** #endif
  27:tmk_core/common/keyboard.h **** 
  28:tmk_core/common/keyboard.h **** /* key matrix position */
  29:tmk_core/common/keyboard.h **** typedef struct {
  30:tmk_core/common/keyboard.h ****     uint8_t col;
  31:tmk_core/common/keyboard.h ****     uint8_t row;
  32:tmk_core/common/keyboard.h **** } keypos_t;
  33:tmk_core/common/keyboard.h **** 
  34:tmk_core/common/keyboard.h **** /* key event */
  35:tmk_core/common/keyboard.h **** typedef struct {
  36:tmk_core/common/keyboard.h ****     keypos_t key;
  37:tmk_core/common/keyboard.h ****     bool     pressed;
  38:tmk_core/common/keyboard.h ****     uint16_t time;
  39:tmk_core/common/keyboard.h **** } keyevent_t;
  40:tmk_core/common/keyboard.h **** 
  41:tmk_core/common/keyboard.h **** /* equivalent test of keypos_t */
  42:tmk_core/common/keyboard.h **** #define KEYEQ(keya, keyb) ((keya).row == (keyb).row && (keya).col == (keyb).col)
  43:tmk_core/common/keyboard.h **** 
  44:tmk_core/common/keyboard.h **** /* Rules for No Event:
  45:tmk_core/common/keyboard.h ****  * 1) (time == 0) to handle (keyevent_t){} as empty event
  46:tmk_core/common/keyboard.h ****  * 2) Matrix(255, 255) to make TICK event available
  47:tmk_core/common/keyboard.h ****  */
  48:tmk_core/common/keyboard.h **** static inline bool IS_NOEVENT(keyevent_t event) { return event.time == 0 || (event.key.row == 255 &
 264               		.loc 2 48 20 view .LVU58
 265               	.LBB12:
 266               		.loc 2 48 51 view .LVU59
 267 0040 90E0      		ldi r25,0
 268               		.loc 2 48 74 is_stmt 0 view .LVU60
 269 0042 1097      		sbiw r26,0
 270 0044 01F0      		breq .L14
 271 0046 DF3F      		cpi r29,lo8(-1)
 272 0048 01F4      		brne .L27
 273               	.L14:
 274               	.LBE12:
 275               	.LBE11:
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 276               		.loc 1 378 69 is_stmt 1 discriminator 2 view .LVU61
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 277               		.loc 1 378 76 is_stmt 0 discriminator 2 view .LVU62
 278 004a 0196      		adiw r24,1
 279               	.LVL15:
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 280               		.loc 1 378 71 discriminator 2 view .LVU63
 281 004c 8770      		andi r24,lo8(7)
 378:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) && !waiting_buffer[i].event.pressed && WITH
 282               		.loc 1 378 71 discriminator 2 view .LVU64
 283 004e 00C0      		rjmp .L13
 284               	.LVL16:
 285               	.L27:
 379:tmk_core/common/action_tapping.c ****             tapping_key.tap.count       = 1;
 286               		.loc 1 379 13 view .LVU65
 287 0050 189F      		mul r17,r24
 288 0052 9001      		movw r18,r0
 289 0054 199F      		mul r17,r25
 290 0056 300D      		add r19,r0
 291 0058 1124      		clr __zero_reg__
 292 005a F901      		movw r30,r18
 293 005c E050      		subi r30,lo8(-(waiting_buffer))
 294 005e F040      		sbci r31,hi8(-(waiting_buffer))
 295 0060 4181      		ldd r20,Z+1
 296 0062 4713      		cpse r20,r23
 297 0064 00C0      		rjmp .L14
 379:tmk_core/common/action_tapping.c ****             tapping_key.tap.count       = 1;
 298               		.loc 1 379 13 discriminator 2 view .LVU66
 299 0066 4081      		ld r20,Z
 300 0068 4613      		cpse r20,r22
 301 006a 00C0      		rjmp .L14
 379:tmk_core/common/action_tapping.c ****             tapping_key.tap.count       = 1;
 302               		.loc 1 379 57 discriminator 3 view .LVU67
 303 006c 4281      		ldd r20,Z+2
 304 006e 4111      		cpse r20,__zero_reg__
 305 0070 00C0      		rjmp .L14
 379:tmk_core/common/action_tapping.c ****             tapping_key.tap.count       = 1;
 306               		.loc 1 379 96 discriminator 4 view .LVU68
 307 0072 4381      		ldd r20,Z+3
 308 0074 5481      		ldd r21,Z+4
 309 0076 4A1B      		sub r20,r26
 310 0078 5B0B      		sbc r21,r27
 379:tmk_core/common/action_tapping.c ****             tapping_key.tap.count       = 1;
 311               		.loc 1 379 93 discriminator 4 view .LVU69
 312 007a 483C      		cpi r20,-56
 313 007c 5105      		cpc r21,__zero_reg__
 314 007e 00F4      		brsh .L14
 380:tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 315               		.loc 1 380 13 is_stmt 1 view .LVU70
 380:tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 316               		.loc 1 380 41 is_stmt 0 view .LVU71
 317 0080 8091 0000 		lds r24,tapping_key+5
 318               	.LVL17:
 380:tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 319               		.loc 1 380 41 view .LVU72
 320 0084 8F70      		andi r24,lo8(15)
 321 0086 8061      		ori r24,lo8(16)
 322 0088 8093 0000 		sts tapping_key+5,r24
 381:tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 323               		.loc 1 381 13 is_stmt 1 view .LVU73
 381:tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 324               		.loc 1 381 41 is_stmt 0 view .LVU74
 325 008c F901      		movw r30,r18
 326 008e E050      		subi r30,lo8(-(waiting_buffer+5))
 327 0090 F040      		sbci r31,hi8(-(waiting_buffer+5))
 328 0092 8081      		ld r24,Z
 329 0094 8F70      		andi r24,lo8(15)
 330 0096 8061      		ori r24,lo8(16)
 331 0098 8083      		st Z,r24
 382:tmk_core/common/action_tapping.c **** 
 332               		.loc 1 382 13 is_stmt 1 view .LVU75
 333 009a 80E0      		ldi r24,lo8(tapping_key)
 334 009c 90E0      		ldi r25,hi8(tapping_key)
 335 009e 0E94 0000 		call process_record
 336               	.LVL18:
 384:tmk_core/common/action_tapping.c ****             debug_dec(i);
 337               		.loc 1 384 57 view .LVU76
 385:tmk_core/common/action_tapping.c ****             debug("]\n");
 338               		.loc 1 385 25 view .LVU77
 386:tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 339               		.loc 1 386 25 view .LVU78
 387:tmk_core/common/action_tapping.c ****             return;
 340               		.loc 1 387 13 view .LVU79
 341               	/* epilogue start */
 342               	.LBE13:
 391:tmk_core/common/action_tapping.c **** 
 343               		.loc 1 391 1 is_stmt 0 view .LVU80
 344 00a2 DF91      		pop r29
 345 00a4 CF91      		pop r28
 346 00a6 1F91      		pop r17
 347               	.LBB14:
 387:tmk_core/common/action_tapping.c ****             return;
 348               		.loc 1 387 13 view .LVU81
 349 00a8 0C94 0000 		jmp debug_waiting_buffer
 350               	.LVL19:
 351               	.LBE14:
 352               		.cfi_endproc
 353               	.LFE11:
 355               		.section	.text.process_tapping,"ax",@progbits
 357               	process_tapping:
 358               	.LVL20:
 359               	.LFB6:
  99:tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
 360               		.loc 1 99 41 is_stmt 1 view -0
 361               		.cfi_startproc
  99:tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
 362               		.loc 1 99 41 is_stmt 0 view .LVU83
 363 0000 8F92      		push r8
 364               	.LCFI6:
 365               		.cfi_def_cfa_offset 3
 366               		.cfi_offset 8, -2
 367 0002 9F92      		push r9
 368               	.LCFI7:
 369               		.cfi_def_cfa_offset 4
 370               		.cfi_offset 9, -3
 371 0004 AF92      		push r10
 372               	.LCFI8:
 373               		.cfi_def_cfa_offset 5
 374               		.cfi_offset 10, -4
 375 0006 BF92      		push r11
 376               	.LCFI9:
 377               		.cfi_def_cfa_offset 6
 378               		.cfi_offset 11, -5
 379 0008 CF92      		push r12
 380               	.LCFI10:
 381               		.cfi_def_cfa_offset 7
 382               		.cfi_offset 12, -6
 383 000a DF92      		push r13
 384               	.LCFI11:
 385               		.cfi_def_cfa_offset 8
 386               		.cfi_offset 13, -7
 387 000c EF92      		push r14
 388               	.LCFI12:
 389               		.cfi_def_cfa_offset 9
 390               		.cfi_offset 14, -8
 391 000e FF92      		push r15
 392               	.LCFI13:
 393               		.cfi_def_cfa_offset 10
 394               		.cfi_offset 15, -9
 395 0010 0F93      		push r16
 396               	.LCFI14:
 397               		.cfi_def_cfa_offset 11
 398               		.cfi_offset 16, -10
 399 0012 1F93      		push r17
 400               	.LCFI15:
 401               		.cfi_def_cfa_offset 12
 402               		.cfi_offset 17, -11
 403 0014 CF93      		push r28
 404               	.LCFI16:
 405               		.cfi_def_cfa_offset 13
 406               		.cfi_offset 28, -12
 407 0016 DF93      		push r29
 408               	.LCFI17:
 409               		.cfi_def_cfa_offset 14
 410               		.cfi_offset 29, -13
 411 0018 CDB7      		in r28,__SP_L__
 412 001a DEB7      		in r29,__SP_H__
 413               	.LCFI18:
 414               		.cfi_def_cfa_register 28
 415 001c 6197      		sbiw r28,17
 416               	.LCFI19:
 417               		.cfi_def_cfa_offset 31
 418 001e 0FB6      		in __tmp_reg__,__SREG__
 419 0020 F894      		cli
 420 0022 DEBF      		out __SP_H__,r29
 421 0024 0FBE      		out __SREG__,__tmp_reg__
 422 0026 CDBF      		out __SP_L__,r28
 423               	/* prologue: function */
 424               	/* frame size = 17 */
 425               	/* stack size = 29 */
 426               	.L__stack_usage = 29
 427 0028 8C01      		movw r16,r24
 100:tmk_core/common/action_tapping.c **** 
 428               		.loc 1 100 5 is_stmt 1 view .LVU84
 100:tmk_core/common/action_tapping.c **** 
 429               		.loc 1 100 16 is_stmt 0 view .LVU85
 430 002a 85E0      		ldi r24,lo8(5)
 431               	.LVL21:
 100:tmk_core/common/action_tapping.c **** 
 432               		.loc 1 100 16 view .LVU86
 433 002c F801      		movw r30,r16
 434 002e DE01      		movw r26,r28
 435 0030 1D96      		adiw r26,13
 436               		0:
 437 0032 0190      		ld r0,Z+
 438 0034 0D92      		st X+,r0
 439 0036 8A95      		dec r24
 440 0038 01F4      		brne 0b
 441 003a D801      		movw r26,r16
 442 003c EC90      		ld r14,X
 443               	.LVL22:
 100:tmk_core/common/action_tapping.c **** 
 444               		.loc 1 100 16 view .LVU87
 445 003e 1196      		adiw r26,1
 446 0040 FC90      		ld r15,X
 447 0042 1197      		sbiw r26,1
 448               	.LVL23:
 100:tmk_core/common/action_tapping.c **** 
 449               		.loc 1 100 16 view .LVU88
 450 0044 1296      		adiw r26,2
 451 0046 CC90      		ld r12,X
 452 0048 1297      		sbiw r26,2
 453               	.LVL24:
 103:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 454               		.loc 1 103 5 is_stmt 1 view .LVU89
 103:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 455               		.loc 1 103 9 is_stmt 0 view .LVU90
 456 004a 80E0      		ldi r24,lo8(tapping_key)
 457 004c A82E      		mov r10,r24
 458 004e 80E0      		ldi r24,hi8(tapping_key)
 459 0050 B82E      		mov r11,r24
 460 0052 4091 0000 		lds r20,tapping_key+3
 461 0056 5091 0000 		lds r21,tapping_key+3+1
 462               	.LBB26:
 463               	.LBI26:
 464               		.loc 2 48 20 is_stmt 1 view .LVU91
 465               	.LBB27:
 466               		.loc 2 48 51 view .LVU92
 467               		.loc 2 48 74 is_stmt 0 view .LVU93
 468 005a 4115      		cp r20,__zero_reg__
 469 005c 5105      		cpc r21,__zero_reg__
 470 005e 01F4      		brne .+2
 471 0060 00C0      		rjmp .L29
 472               	.LBE27:
 473               	.LBE26:
 103:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 474               		.loc 1 103 9 view .LVU94
 475 0062 9091 0000 		lds r25,tapping_key
 476 0066 2091 0000 		lds r18,tapping_key+1
 477               	.LBB29:
 478               	.LBB28:
 479               		.loc 2 48 74 view .LVU95
 480 006a 892F      		mov r24,r25
 481 006c 8223      		and r24,r18
 482 006e 8F3F      		cpi r24,lo8(-1)
 483 0070 01F4      		brne .+2
 484 0072 00C0      		rjmp .L29
 485               	.LBE28:
 486               	.LBE29:
 100:tmk_core/common/action_tapping.c **** 
 487               		.loc 1 100 16 discriminator 1 view .LVU96
 488 0074 1396      		adiw r26,3
 489 0076 8D90      		ld r8,X+
 490 0078 9C90      		ld r9,X
 491 007a 1497      		sbiw r26,3+1
 103:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 492               		.loc 1 103 9 discriminator 1 view .LVU97
 493 007c D090 0000 		lds r13,tapping_key+2
 494 0080 F401      		movw r30,r8
 495 0082 E41B      		sub r30,r20
 496 0084 F50B      		sbc r31,r21
 497 0086 DD20      		tst r13
 498 0088 01F4      		brne .+2
 499 008a 00C0      		rjmp .L30
 104:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 500               		.loc 1 104 9 is_stmt 1 view .LVU98
 501 008c 8091 0000 		lds r24,tapping_key+5
 502 0090 382F      		mov r19,r24
 503 0092 307F      		andi r19,lo8(-16)
 104:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 504               		.loc 1 104 12 is_stmt 0 view .LVU99
 505 0094 E83C      		cpi r30,-56
 506 0096 F105      		cpc r31,__zero_reg__
 507 0098 00F0      		brlo .+2
 508 009a 00C0      		rjmp .L31
 105:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 509               		.loc 1 105 13 is_stmt 1 view .LVU100
 105:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 510               		.loc 1 105 16 is_stmt 0 view .LVU101
 511 009c 3111      		cpse r19,__zero_reg__
 512 009e 00C0      		rjmp .L32
 106:tmk_core/common/action_tapping.c ****                     // first tap!
 513               		.loc 1 106 17 is_stmt 1 discriminator 1 view .LVU102
 514 00a0 DC2C      		mov r13,r12
 106:tmk_core/common/action_tapping.c ****                     // first tap!
 515               		.loc 1 106 21 is_stmt 0 discriminator 1 view .LVU103
 516 00a2 2F11      		cpse r18,r15
 517 00a4 00C0      		rjmp .L33
 106:tmk_core/common/action_tapping.c ****                     // first tap!
 518               		.loc 1 106 21 discriminator 2 view .LVU104
 519 00a6 9E11      		cpse r25,r14
 520 00a8 00C0      		rjmp .L33
 106:tmk_core/common/action_tapping.c ****                     // first tap!
 521               		.loc 1 106 47 discriminator 3 view .LVU105
 522 00aa C110      		cpse r12,__zero_reg__
 523 00ac 00C0      		rjmp .L33
 108:tmk_core/common/action_tapping.c ****                     tapping_key.tap.count = 1;
 524               		.loc 1 108 57 is_stmt 1 view .LVU106
 109:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 525               		.loc 1 109 21 view .LVU107
 109:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 526               		.loc 1 109 43 is_stmt 0 view .LVU108
 527 00ae 8F70      		andi r24,lo8(15)
 528 00b0 8061      		ori r24,lo8(16)
 529 00b2 8093 0000 		sts tapping_key+5,r24
 530               	.LVL25:
 110:tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 531               		.loc 1 110 21 is_stmt 1 view .LVU109
 532 00b6 0E94 0000 		call debug_tapping_key
 533               	.LVL26:
 111:tmk_core/common/action_tapping.c **** 
 534               		.loc 1 111 21 view .LVU110
 535 00ba C501      		movw r24,r10
 536 00bc 0E94 0000 		call process_record
 537               	.LVL27:
 114:tmk_core/common/action_tapping.c ****                     // enqueue
 538               		.loc 1 114 21 view .LVU111
 114:tmk_core/common/action_tapping.c ****                     // enqueue
 539               		.loc 1 114 31 is_stmt 0 view .LVU112
 540 00c0 8091 0000 		lds r24,tapping_key+5
 541 00c4 D801      		movw r26,r16
 542 00c6 1596      		adiw r26,5
 543 00c8 8C93      		st X,r24
 116:tmk_core/common/action_tapping.c ****                 }
 544               		.loc 1 116 21 is_stmt 1 view .LVU113
 545               	.LVL28:
 546               	.L28:
 311:tmk_core/common/action_tapping.c **** 
 547               		.loc 1 311 1 is_stmt 0 view .LVU114
 548 00ca 8D2D      		mov r24,r13
 549               	/* epilogue start */
 311:tmk_core/common/action_tapping.c **** 
 550               		.loc 1 311 1 view .LVU115
 551 00cc 6196      		adiw r28,17
 552 00ce 0FB6      		in __tmp_reg__,__SREG__
 553 00d0 F894      		cli
 554 00d2 DEBF      		out __SP_H__,r29
 555 00d4 0FBE      		out __SREG__,__tmp_reg__
 556 00d6 CDBF      		out __SP_L__,r28
 557 00d8 DF91      		pop r29
 558 00da CF91      		pop r28
 559 00dc 1F91      		pop r17
 560 00de 0F91      		pop r16
 561               	.LVL29:
 311:tmk_core/common/action_tapping.c **** 
 562               		.loc 1 311 1 view .LVU116
 563 00e0 FF90      		pop r15
 311:tmk_core/common/action_tapping.c **** 
 564               		.loc 1 311 1 view .LVU117
 565 00e2 EF90      		pop r14
 311:tmk_core/common/action_tapping.c **** 
 566               		.loc 1 311 1 view .LVU118
 567 00e4 DF90      		pop r13
 568 00e6 CF90      		pop r12
 569               	.LVL30:
 311:tmk_core/common/action_tapping.c **** 
 570               		.loc 1 311 1 view .LVU119
 571 00e8 BF90      		pop r11
 572 00ea AF90      		pop r10
 573 00ec 9F90      		pop r9
 574 00ee 8F90      		pop r8
 575 00f0 0895      		ret
 576               	.LVL31:
 577               	.L33:
 123:tmk_core/common/action_tapping.c **** #        ifdef TAPPING_TERM_PER_KEY
 578               		.loc 1 123 22 is_stmt 1 view .LVU120
 579               	.LBB30:
 580               	.LBI30:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
  50:tmk_core/common/keyboard.h **** static inline bool IS_RELEASED(keyevent_t event) { return (!IS_NOEVENT(event) && !event.pressed); }
 581               		.loc 2 50 20 view .LVU121
 582               	.LBB31:
 583               		.loc 2 50 52 view .LVU122
 584               	.LBB32:
 585               	.LBI32:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 586               		.loc 2 48 20 view .LVU123
 587               	.LBB33:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 588               		.loc 2 48 51 view .LVU124
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 589               		.loc 2 48 74 is_stmt 0 view .LVU125
 590 00f2 8114      		cp r8,__zero_reg__
 591 00f4 9104      		cpc r9,__zero_reg__
 592 00f6 01F0      		breq .L59
 593 00f8 8F2D      		mov r24,r15
 594 00fa 8E21      		and r24,r14
 595 00fc 8F3F      		cpi r24,lo8(-1)
 596 00fe 01F0      		breq .+2
 597 0100 00C0      		rjmp .L36
 598               	.L59:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 599               		.loc 2 48 74 view .LVU126
 600               	.LBE33:
 601               	.LBE32:
 602               		.loc 2 50 79 view .LVU127
 603 0102 80E0      		ldi r24,0
 604               	.L35:
 605               	.LVL32:
 606               		.loc 2 50 79 view .LVU128
 607               	.LBE31:
 608               	.LBE30:
 123:tmk_core/common/action_tapping.c **** #        ifdef TAPPING_TERM_PER_KEY
 609               		.loc 1 123 25 view .LVU129
 610 0104 80FF      		sbrs r24,0
 611 0106 00C0      		rjmp .L37
 130:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 612               		.loc 1 130 43 view .LVU130
 613 0108 4C2D      		mov r20,r12
 614 010a 6F2D      		mov r22,r15
 615 010c 8E2D      		mov r24,r14
 616 010e 0E94 0000 		call waiting_buffer_typed.isra.1
 617               	.LVL33:
 130:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 618               		.loc 1 130 40 view .LVU131
 619 0112 8823      		tst r24
 620 0114 01F0      		breq .L37
 131:tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 621               		.loc 1 131 78 is_stmt 1 view .LVU132
 132:tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 622               		.loc 1 132 21 view .LVU133
 623 0116 80E0      		ldi r24,lo8(tapping_key)
 624 0118 90E0      		ldi r25,hi8(tapping_key)
 625 011a 0E94 0000 		call process_record
 626               	.LVL34:
 133:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 627               		.loc 1 133 21 view .LVU134
 133:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 628               		.loc 1 133 33 is_stmt 0 view .LVU135
 629 011e 86E0      		ldi r24,lo8(6)
 630 0120 E0E0      		ldi r30,lo8(tapping_key)
 631 0122 F0E0      		ldi r31,hi8(tapping_key)
 632 0124 DF01      		movw r26,r30
 633               		0:
 634 0126 1D92      		st X+,__zero_reg__
 635 0128 8A95      		dec r24
 636 012a 01F4      		brne 0b
 134:tmk_core/common/action_tapping.c ****                     // enqueue
 637               		.loc 1 134 21 is_stmt 1 view .LVU136
 638               	.LVL35:
 639               	.L124:
 211:tmk_core/common/action_tapping.c ****                 return false;
 640               		.loc 1 211 17 view .LVU137
 641 012c 0E94 0000 		call debug_tapping_key
 642               	.LVL36:
 212:tmk_core/common/action_tapping.c ****             } else {
 643               		.loc 1 212 17 view .LVU138
 644 0130 00C0      		rjmp .L122
 645               	.LVL37:
 646               	.L37:
 143:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 647               		.loc 1 143 22 view .LVU139
 648               	.LBB35:
 649               	.LBI35:
 650               		.loc 2 50 20 view .LVU140
 651               	.LBB36:
 652               		.loc 2 50 52 view .LVU141
 653               	.LBB37:
 654               	.LBI37:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 655               		.loc 2 48 20 view .LVU142
 656               	.LBB38:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 657               		.loc 2 48 51 view .LVU143
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 658               		.loc 2 48 74 is_stmt 0 view .LVU144
 659 0132 8928      		or r8,r9
 660 0134 01F0      		breq .L60
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 661               		.loc 2 48 74 view .LVU145
 662 0136 8F2D      		mov r24,r15
 663 0138 8E21      		and r24,r14
 664 013a 8F3F      		cpi r24,lo8(-1)
 665 013c 01F0      		breq .+2
 666 013e 00C0      		rjmp .L39
 667               	.L60:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 668               		.loc 2 48 74 view .LVU146
 669               	.LBE38:
 670               	.LBE37:
 671               		.loc 2 50 79 view .LVU147
 672 0140 80E0      		ldi r24,0
 673               	.L38:
 674               	.LVL38:
 675               		.loc 2 50 79 view .LVU148
 676               	.LBE36:
 677               	.LBE35:
 143:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 678               		.loc 1 143 25 view .LVU149
 679 0142 B82F      		mov r27,r24
 680 0144 B170      		andi r27,lo8(1)
 681 0146 AB2E      		mov r10,r27
 682 0148 80FF      		sbrs r24,0
 683 014a 00C0      		rjmp .L40
 143:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 684               		.loc 1 143 49 discriminator 1 view .LVU150
 685 014c 4C2D      		mov r20,r12
 686 014e 6F2D      		mov r22,r15
 687 0150 8E2D      		mov r24,r14
 688 0152 0E94 0000 		call waiting_buffer_typed.isra.1
 689               	.LVL39:
 690 0156 B82E      		mov r11,r24
 143:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 691               		.loc 1 143 45 discriminator 1 view .LVU151
 692 0158 8111      		cpse r24,__zero_reg__
 693 015a 00C0      		rjmp .L40
 694               	.LBB40:
 145:tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 695               		.loc 1 145 21 is_stmt 1 view .LVU152
 145:tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 696               		.loc 1 145 39 is_stmt 0 view .LVU153
 697 015c ED86      		std Y+13,r14
 698 015e FE86      		std Y+14,r15
 699 0160 8D85      		ldd r24,Y+13
 700 0162 9E85      		ldd r25,Y+14
 701 0164 0E94 0000 		call layer_switch_get_action
 702               	.LVL40:
 146:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 703               		.loc 1 146 21 is_stmt 1 view .LVU154
 146:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 704               		.loc 1 146 40 is_stmt 0 view .LVU155
 705 0168 292F      		mov r18,r25
 706 016a 2295      		swap r18
 707 016c 2F70      		andi r18,lo8(15)
 146:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 708               		.loc 1 146 21 view .LVU156
 709 016e 2230      		cpi r18,lo8(2)
 710 0170 00F0      		brlo .L41
 146:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 711               		.loc 1 146 21 view .LVU157
 712 0172 2430      		cpi r18,lo8(4)
 713 0174 00F4      		brsh .L42
 154:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 714               		.loc 1 154 29 is_stmt 1 view .LVU158
 154:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 715               		.loc 1 154 33 is_stmt 0 view .LVU159
 716 0176 9F70      		andi r25,lo8(15)
 717               	.LVL41:
 154:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 718               		.loc 1 154 32 view .LVU160
 719 0178 01F0      		breq .L46
 154:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 720               		.loc 1 154 68 discriminator 1 view .LVU161
 721 017a F801      		movw r30,r16
 722 017c 9581      		ldd r25,Z+5
 723 017e 907F      		andi r25,lo8(-16)
 154:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 724               		.loc 1 154 49 discriminator 1 view .LVU162
 725 0180 01F4      		brne .L46
 726               	.LVL42:
 727               	.L45:
 154:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 728               		.loc 1 154 49 discriminator 1 view .LVU163
 729 0182 DB2C      		mov r13,r11
 730 0184 00C0      		rjmp .L28
 731               	.LVL43:
 732               	.L41:
 149:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 733               		.loc 1 149 29 is_stmt 1 view .LVU164
 149:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 734               		.loc 1 149 33 is_stmt 0 view .LVU165
 735 0186 9F70      		andi r25,lo8(15)
 736               	.LVL44:
 149:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 737               		.loc 1 149 32 view .LVU166
 738 0188 01F0      		breq .L46
 149:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 739               		.loc 1 149 49 discriminator 1 view .LVU167
 740 018a 8823      		tst r24
 741 018c 01F0      		breq .L45
 742               	.L46:
 155:tmk_core/common/action_tapping.c ****                             break;
 743               		.loc 1 155 29 is_stmt 1 view .LVU168
 155:tmk_core/common/action_tapping.c ****                             break;
 744               		.loc 1 155 33 is_stmt 0 view .LVU169
 745 018e 805E      		subi r24,lo8(-(32))
 746               	.LVL45:
 155:tmk_core/common/action_tapping.c ****                             break;
 747               		.loc 1 155 32 view .LVU170
 748 0190 8830      		cpi r24,lo8(8)
 749 0192 00F0      		brlo .L45
 750               	.LVL46:
 751               	.L42:
 159:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 752               		.loc 1 159 86 is_stmt 1 view .LVU171
 160:tmk_core/common/action_tapping.c ****                     return true;
 753               		.loc 1 160 21 view .LVU172
 754 0194 C801      		movw r24,r16
 755               	.LVL47:
 160:tmk_core/common/action_tapping.c ****                     return true;
 756               		.loc 1 160 21 is_stmt 0 view .LVU173
 757 0196 0E94 0000 		call process_record
 758               	.LVL48:
 161:tmk_core/common/action_tapping.c ****                 } else {
 759               		.loc 1 161 21 is_stmt 1 view .LVU174
 161:tmk_core/common/action_tapping.c ****                 } else {
 760               		.loc 1 161 28 is_stmt 0 view .LVU175
 761 019a BA2C      		mov r11,r10
 762 019c 00C0      		rjmp .L45
 763               	.LVL49:
 764               	.L40:
 161:tmk_core/common/action_tapping.c ****                 } else {
 765               		.loc 1 161 28 view .LVU176
 766               	.LBE40:
 164:tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 767               		.loc 1 164 21 is_stmt 1 view .LVU177
 164:tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 768               		.loc 1 164 24 is_stmt 0 view .LVU178
 769 019e CC20      		tst r12
 770 01a0 01F4      		brne .+2
 771 01a2 00C0      		rjmp .L28
 165:tmk_core/common/action_tapping.c ****                     }
 772               		.loc 1 165 25 is_stmt 1 view .LVU179
 165:tmk_core/common/action_tapping.c ****                     }
 773               		.loc 1 165 53 is_stmt 0 view .LVU180
 774 01a4 8091 0000 		lds r24,tapping_key+5
 775 01a8 8160      		ori r24,lo8(1<<0)
 776 01aa 8093 0000 		sts tapping_key+5,r24
 777               	.LVL50:
 778               	.L122:
 168:tmk_core/common/action_tapping.c ****                 }
 779               		.loc 1 168 28 view .LVU181
 780 01ae D12C      		mov r13,__zero_reg__
 781 01b0 00C0      		rjmp .L28
 782               	.L32:
 173:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release(");
 783               		.loc 1 173 17 is_stmt 1 discriminator 1 view .LVU182
 173:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release(");
 784               		.loc 1 173 21 is_stmt 0 discriminator 1 view .LVU183
 785 01b2 2F11      		cpse r18,r15
 786 01b4 00C0      		rjmp .L47
 173:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release(");
 787               		.loc 1 173 21 discriminator 2 view .LVU184
 788 01b6 9E11      		cpse r25,r14
 789 01b8 00C0      		rjmp .L47
 173:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release(");
 790               		.loc 1 173 47 discriminator 3 view .LVU185
 791 01ba CC20      		tst r12
 792 01bc 01F4      		brne .+2
 793 01be 00C0      		rjmp .L125
 794               	.L47:
 182:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 795               		.loc 1 182 24 is_stmt 1 view .LVU186
 182:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 796               		.loc 1 182 28 is_stmt 0 view .LVU187
 797 01c0 ED86      		std Y+13,r14
 798 01c2 FE86      		std Y+14,r15
 799 01c4 8D85      		ldd r24,Y+13
 800 01c6 9E85      		ldd r25,Y+14
 801 01c8 0E94 0000 		call is_tap_key
 802               	.LVL51:
 182:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 803               		.loc 1 182 27 view .LVU188
 804 01cc 8823      		tst r24
 805 01ce 01F0      		breq .L55
 182:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 806               		.loc 1 182 50 discriminator 1 view .LVU189
 807 01d0 CC20      		tst r12
 808 01d2 01F0      		breq .L55
 183:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 809               		.loc 1 183 21 is_stmt 1 view .LVU190
 183:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 810               		.loc 1 183 40 is_stmt 0 view .LVU191
 811 01d4 8091 0000 		lds r24,tapping_key+5
 183:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 812               		.loc 1 183 24 view .LVU192
 813 01d8 8032      		cpi r24,lo8(32)
 814 01da 00F0      		brlo .L50
 184:tmk_core/common/action_tapping.c ****                         // unregister key
 815               		.loc 1 184 87 is_stmt 1 view .LVU193
 186:tmk_core/common/action_tapping.c ****                     } else {
 816               		.loc 1 186 25 view .LVU194
 186:tmk_core/common/action_tapping.c ****                     } else {
 817               		.loc 1 186 54 is_stmt 0 view .LVU195
 818 01dc 2091 0000 		lds r18,tapping_key
 819 01e0 3091 0000 		lds r19,tapping_key+1
 820 01e4 3887      		std Y+8,r19
 821 01e6 2F83      		std Y+7,r18
 822 01e8 1986      		std Y+9,__zero_reg__
 823 01ea 9B86      		std Y+11,r9
 824 01ec 8A86      		std Y+10,r8
 825 01ee 8C87      		std Y+12,r24
 186:tmk_core/common/action_tapping.c ****                     } else {
 826               		.loc 1 186 25 view .LVU196
 827 01f0 CE01      		movw r24,r28
 828 01f2 0796      		adiw r24,7
 829               	.L120:
 186:tmk_core/common/action_tapping.c ****                     } else {
 830               		.loc 1 186 25 view .LVU197
 831 01f4 0E94 0000 		call process_record
 832               	.LVL52:
 833               	.L50:
 188:tmk_core/common/action_tapping.c ****                     }
 834               		.loc 1 188 69 is_stmt 1 view .LVU198
 190:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 835               		.loc 1 190 21 view .LVU199
 190:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 836               		.loc 1 190 33 is_stmt 0 view .LVU200
 837 01f8 86E0      		ldi r24,lo8(6)
 838 01fa F801      		movw r30,r16
 839 01fc A0E0      		ldi r26,lo8(tapping_key)
 840 01fe B0E0      		ldi r27,hi8(tapping_key)
 841               		0:
 842 0200 0190      		ld r0,Z+
 843 0202 0D92      		st X+,r0
 844 0204 8A95      		dec r24
 845 0206 01F4      		brne 0b
 191:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 846               		.loc 1 191 21 is_stmt 1 view .LVU201
 847 0208 0E94 0000 		call waiting_buffer_scan_tap
 848               	.LVL53:
 192:tmk_core/common/action_tapping.c ****                     return true;
 849               		.loc 1 192 21 view .LVU202
 850 020c 0E94 0000 		call debug_tapping_key
 851               	.LVL54:
 193:tmk_core/common/action_tapping.c ****                 } else {
 852               		.loc 1 193 21 view .LVU203
 853               	.L123:
 199:tmk_core/common/action_tapping.c ****                 }
 854               		.loc 1 199 21 view .LVU204
 199:tmk_core/common/action_tapping.c ****                 }
 855               		.loc 1 199 28 is_stmt 0 view .LVU205
 856 0210 DD24      		clr r13
 857 0212 D394      		inc r13
 858 0214 00C0      		rjmp .L28
 859               	.L55:
 195:tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last tap(>0).\n");
 860               		.loc 1 195 21 is_stmt 1 view .LVU206
 196:tmk_core/common/action_tapping.c ****                     }
 861               		.loc 1 196 74 view .LVU207
 198:tmk_core/common/action_tapping.c ****                     return true;
 862               		.loc 1 198 21 view .LVU208
 863 0216 C801      		movw r24,r16
 864 0218 0E94 0000 		call process_record
 865               	.LVL55:
 866 021c 00C0      		rjmp .L123
 867               	.LVL56:
 868               	.L31:
 205:tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 869               		.loc 1 205 13 view .LVU209
 205:tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 870               		.loc 1 205 16 is_stmt 0 view .LVU210
 871 021e 3111      		cpse r19,__zero_reg__
 872 0220 00C0      		rjmp .L51
 206:tmk_core/common/action_tapping.c ****                 debug_event(event);
 873               		.loc 1 206 61 is_stmt 1 view .LVU211
 207:tmk_core/common/action_tapping.c ****                 debug("\n");
 874               		.loc 1 207 17 view .LVU212
 207:tmk_core/common/action_tapping.c ****                 debug("\n");
 875               		.loc 1 207 17 is_stmt 0 view .LVU213
 876 0222 782D      		mov r23,r8
 877 0224 998A      		std Y+17,r9
 878 0226 888A      		std Y+16,r8
 879 0228 A701      		movw r20,r14
 880 022a 6C2D      		mov r22,r12
 881 022c 8989      		ldd r24,Y+17
 882 022e 0E94 0000 		call debug_event
 883               	.LVL57:
 208:tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 884               		.loc 1 208 28 is_stmt 1 view .LVU214
 209:tmk_core/common/action_tapping.c ****                 tapping_key = (keyrecord_t){};
 885               		.loc 1 209 17 view .LVU215
 886 0232 80E0      		ldi r24,lo8(tapping_key)
 887 0234 90E0      		ldi r25,hi8(tapping_key)
 888 0236 0E94 0000 		call process_record
 889               	.LVL58:
 210:tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 890               		.loc 1 210 17 view .LVU216
 210:tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 891               		.loc 1 210 29 is_stmt 0 view .LVU217
 892 023a 86E0      		ldi r24,lo8(6)
 893 023c F501      		movw r30,r10
 894               		0:
 895 023e 1192      		st Z+,__zero_reg__
 896 0240 8A95      		dec r24
 897 0242 01F4      		brne 0b
 898 0244 00C0      		rjmp .L124
 899               	.L51:
 214:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 900               		.loc 1 214 17 is_stmt 1 discriminator 1 view .LVU218
 214:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 901               		.loc 1 214 21 is_stmt 0 discriminator 1 view .LVU219
 902 0246 2F11      		cpse r18,r15
 903 0248 00C0      		rjmp .L52
 214:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 904               		.loc 1 214 21 discriminator 2 view .LVU220
 905 024a 9E11      		cpse r25,r14
 906 024c 00C0      		rjmp .L52
 214:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 907               		.loc 1 214 47 discriminator 3 view .LVU221
 908 024e C110      		cpse r12,__zero_reg__
 909 0250 00C0      		rjmp .L52
 215:tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 910               		.loc 1 215 73 is_stmt 1 view .LVU222
 216:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 911               		.loc 1 216 21 view .LVU223
 216:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 912               		.loc 1 216 31 is_stmt 0 view .LVU224
 913 0252 1596      		adiw r26,5
 914 0254 8C93      		st X,r24
 217:tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 915               		.loc 1 217 21 is_stmt 1 view .LVU225
 916 0256 C801      		movw r24,r16
 917 0258 0E94 0000 		call process_record
 918               	.LVL59:
 218:tmk_core/common/action_tapping.c ****                     return true;
 919               		.loc 1 218 21 view .LVU226
 218:tmk_core/common/action_tapping.c ****                     return true;
 920               		.loc 1 218 33 is_stmt 0 view .LVU227
 921 025c 86E0      		ldi r24,lo8(6)
 922 025e F501      		movw r30,r10
 923               		0:
 924 0260 1192      		st Z+,__zero_reg__
 925 0262 8A95      		dec r24
 926 0264 01F4      		brne 0b
 219:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key) && event.pressed) {
 927               		.loc 1 219 21 is_stmt 1 view .LVU228
 219:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key) && event.pressed) {
 928               		.loc 1 219 28 is_stmt 0 view .LVU229
 929 0266 00C0      		rjmp .L28
 930               	.L52:
 220:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 931               		.loc 1 220 24 is_stmt 1 view .LVU230
 220:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 932               		.loc 1 220 28 is_stmt 0 view .LVU231
 933 0268 ED86      		std Y+13,r14
 934 026a FE86      		std Y+14,r15
 935 026c 8D85      		ldd r24,Y+13
 936 026e 9E85      		ldd r25,Y+14
 937 0270 0E94 0000 		call is_tap_key
 938               	.LVL60:
 220:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 939               		.loc 1 220 27 view .LVU232
 940 0274 8823      		tst r24
 941 0276 01F0      		breq .L55
 220:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 942               		.loc 1 220 50 discriminator 1 view .LVU233
 943 0278 CC20      		tst r12
 944 027a 01F0      		breq .L55
 221:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 945               		.loc 1 221 21 is_stmt 1 view .LVU234
 221:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 946               		.loc 1 221 40 is_stmt 0 view .LVU235
 947 027c 8091 0000 		lds r24,tapping_key+5
 221:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 948               		.loc 1 221 24 view .LVU236
 949 0280 8032      		cpi r24,lo8(32)
 950 0282 00F4      		brsh .+2
 951 0284 00C0      		rjmp .L50
 222:tmk_core/common/action_tapping.c ****                         // unregister key
 952               		.loc 1 222 95 is_stmt 1 view .LVU237
 224:tmk_core/common/action_tapping.c ****                     } else {
 953               		.loc 1 224 25 view .LVU238
 224:tmk_core/common/action_tapping.c ****                     } else {
 954               		.loc 1 224 54 is_stmt 0 view .LVU239
 955 0286 2091 0000 		lds r18,tapping_key
 956 028a 3091 0000 		lds r19,tapping_key+1
 957 028e 3A83      		std Y+2,r19
 958 0290 2983      		std Y+1,r18
 959 0292 1B82      		std Y+3,__zero_reg__
 960 0294 9D82      		std Y+5,r9
 961 0296 8C82      		std Y+4,r8
 962 0298 8E83      		std Y+6,r24
 224:tmk_core/common/action_tapping.c ****                     } else {
 963               		.loc 1 224 25 view .LVU240
 964 029a CE01      		movw r24,r28
 965 029c 0196      		adiw r24,1
 966 029e 00C0      		rjmp .L120
 967               	.L30:
 241:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 968               		.loc 1 241 12 is_stmt 1 discriminator 1 view .LVU241
 242:tmk_core/common/action_tapping.c ****             if (event.pressed) {
 969               		.loc 1 242 9 discriminator 1 view .LVU242
 242:tmk_core/common/action_tapping.c ****             if (event.pressed) {
 970               		.loc 1 242 12 is_stmt 0 discriminator 1 view .LVU243
 971 02a0 E83C      		cpi r30,-56
 972 02a2 F105      		cpc r31,__zero_reg__
 973 02a4 00F0      		brlo .+2
 974 02a6 00C0      		rjmp .L54
 243:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 975               		.loc 1 243 13 is_stmt 1 view .LVU244
 243:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 976               		.loc 1 243 22 is_stmt 0 view .LVU245
 977 02a8 DC2C      		mov r13,r12
 243:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 978               		.loc 1 243 16 view .LVU246
 979 02aa CC20      		tst r12
 980 02ac 01F4      		brne .+2
 981 02ae 00C0      		rjmp .L55
 244:tmk_core/common/action_tapping.c **** //#    ifndef TAPPING_FORCE_HOLD
 982               		.loc 1 244 17 is_stmt 1 discriminator 1 view .LVU247
 244:tmk_core/common/action_tapping.c **** //#    ifndef TAPPING_FORCE_HOLD
 983               		.loc 1 244 21 is_stmt 0 discriminator 1 view .LVU248
 984 02b0 2F11      		cpse r18,r15
 985 02b2 00C0      		rjmp .L56
 244:tmk_core/common/action_tapping.c **** //#    ifndef TAPPING_FORCE_HOLD
 986               		.loc 1 244 21 discriminator 2 view .LVU249
 987 02b4 9E11      		cpse r25,r14
 988 02b6 00C0      		rjmp .L56
 247:tmk_core/common/action_tapping.c **** #        ifdef TAPPING_FORCE_HOLD_PER_KEY
 989               		.loc 1 247 21 is_stmt 1 view .LVU250
 251:tmk_core/common/action_tapping.c ****                         // sequential tap.
 990               		.loc 1 251 41 is_stmt 0 view .LVU251
 991 02b8 8091 0000 		lds r24,tapping_key+5
 247:tmk_core/common/action_tapping.c **** #        ifdef TAPPING_FORCE_HOLD_PER_KEY
 992               		.loc 1 247 24 view .LVU252
 993 02bc 80FD      		sbrc r24,0
 994 02be 00C0      		rjmp .L57
 251:tmk_core/common/action_tapping.c ****                         // sequential tap.
 995               		.loc 1 251 79 view .LVU253
 996 02c0 982F      		mov r25,r24
 997 02c2 907F      		andi r25,lo8(-16)
 251:tmk_core/common/action_tapping.c ****                         // sequential tap.
 998               		.loc 1 251 54 view .LVU254
 999 02c4 01F0      		breq .L57
 253:tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 1000               		.loc 1 253 25 is_stmt 1 view .LVU255
 253:tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 1001               		.loc 1 253 35 is_stmt 0 view .LVU256
 1002 02c6 1596      		adiw r26,5
 1003 02c8 8C93      		st X,r24
 1004 02ca 1597      		sbiw r26,5
 254:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press(");
 1005               		.loc 1 254 25 is_stmt 1 view .LVU257
 254:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press(");
 1006               		.loc 1 254 28 is_stmt 0 view .LVU258
 1007 02cc 903F      		cpi r25,lo8(-16)
 1008 02ce 01F0      		breq .L58
 254:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press(");
 1009               		.loc 1 254 51 is_stmt 1 discriminator 1 view .LVU259
 254:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press(");
 1010               		.loc 1 254 67 is_stmt 0 discriminator 1 view .LVU260
 1011 02d0 982F      		mov r25,r24
 1012 02d2 907F      		andi r25,lo8(-16)
 1013 02d4 905F      		subi r25,lo8(-(16))
 1014 02d6 8F70      		andi r24,lo8(15)
 1015 02d8 892B      		or r24,r25
 1016               	.L125:
 254:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press(");
 1017               		.loc 1 254 67 discriminator 1 view .LVU261
 1018 02da 1596      		adiw r26,5
 1019 02dc 8C93      		st X,r24
 1020               	.L58:
 255:tmk_core/common/action_tapping.c ****                         debug_dec(keyp->tap.count);
 1021               		.loc 1 255 53 is_stmt 1 view .LVU262
 256:tmk_core/common/action_tapping.c ****                         debug(")\n");
 1022               		.loc 1 256 51 view .LVU263
 257:tmk_core/common/action_tapping.c ****                         process_record(keyp);
 1023               		.loc 1 257 37 view .LVU264
 258:tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 1024               		.loc 1 258 25 view .LVU265
 1025 02de C801      		movw r24,r16
 1026 02e0 0E94 0000 		call process_record
 1027               	.LVL61:
 259:tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 1028               		.loc 1 259 25 view .LVU266
 259:tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 1029               		.loc 1 259 37 is_stmt 0 view .LVU267
 1030 02e4 86E0      		ldi r24,lo8(6)
 1031 02e6 F801      		movw r30,r16
 1032 02e8 A0E0      		ldi r26,lo8(tapping_key)
 1033 02ea B0E0      		ldi r27,hi8(tapping_key)
 1034               		0:
 1035 02ec 0190      		ld r0,Z+
 1036 02ee 0D92      		st X+,r0
 1037 02f0 8A95      		dec r24
 1038 02f2 01F4      		brne 0b
 260:tmk_core/common/action_tapping.c ****                         return true;
 1039               		.loc 1 260 25 is_stmt 1 view .LVU268
 1040               	.LVL62:
 1041               	.L121:
 304:tmk_core/common/action_tapping.c ****             return true;
 1042               		.loc 1 304 13 view .LVU269
 1043 02f4 0E94 0000 		call debug_tapping_key
 1044               	.LVL63:
 305:tmk_core/common/action_tapping.c ****         } else {
 1045               		.loc 1 305 13 view .LVU270
 305:tmk_core/common/action_tapping.c ****         } else {
 1046               		.loc 1 305 20 is_stmt 0 view .LVU271
 1047 02f8 00C0      		rjmp .L28
 1048               	.LVL64:
 1049               	.L57:
 265:tmk_core/common/action_tapping.c ****                     return true;
 1050               		.loc 1 265 21 is_stmt 1 view .LVU272
 265:tmk_core/common/action_tapping.c ****                     return true;
 1051               		.loc 1 265 33 is_stmt 0 view .LVU273
 1052 02fa 86E0      		ldi r24,lo8(6)
 1053 02fc F801      		movw r30,r16
 1054 02fe A0E0      		ldi r26,lo8(tapping_key)
 1055 0300 B0E0      		ldi r27,hi8(tapping_key)
 1056               		0:
 1057 0302 0190      		ld r0,Z+
 1058 0304 0D92      		st X+,r0
 1059 0306 8A95      		dec r24
 1060 0308 01F4      		brne 0b
 266:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 1061               		.loc 1 266 21 is_stmt 1 view .LVU274
 266:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 1062               		.loc 1 266 28 is_stmt 0 view .LVU275
 1063 030a 00C0      		rjmp .L28
 1064               	.L56:
 267:tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1065               		.loc 1 267 24 is_stmt 1 view .LVU276
 267:tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1066               		.loc 1 267 28 is_stmt 0 view .LVU277
 1067 030c ED86      		std Y+13,r14
 1068 030e FE86      		std Y+14,r15
 1069 0310 8D85      		ldd r24,Y+13
 1070 0312 9E85      		ldd r25,Y+14
 1071 0314 0E94 0000 		call is_tap_key
 1072               	.LVL65:
 267:tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1073               		.loc 1 267 27 view .LVU278
 1074 0318 8111      		cpse r24,__zero_reg__
 1075 031a 00C0      		rjmp .L50
 277:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 1076               		.loc 1 277 21 is_stmt 1 view .LVU279
 277:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 1077               		.loc 1 277 49 is_stmt 0 view .LVU280
 1078 031c 8091 0000 		lds r24,tapping_key+5
 1079 0320 8160      		ori r24,lo8(1<<0)
 1080 0322 8093 0000 		sts tapping_key+5,r24
 278:tmk_core/common/action_tapping.c ****                     return true;
 1081               		.loc 1 278 21 is_stmt 1 view .LVU281
 1082 0326 C801      		movw r24,r16
 1083 0328 0E94 0000 		call process_record
 1084               	.LVL66:
 279:tmk_core/common/action_tapping.c ****                 }
 1085               		.loc 1 279 21 view .LVU282
 279:tmk_core/common/action_tapping.c ****                 }
 1086               		.loc 1 279 28 is_stmt 0 view .LVU283
 1087 032c 00C0      		rjmp .L28
 1088               	.L54:
 289:tmk_core/common/action_tapping.c ****             debug_event(event);
 1089               		.loc 1 289 70 is_stmt 1 view .LVU284
 290:tmk_core/common/action_tapping.c ****             debug("\n");
 1090               		.loc 1 290 13 view .LVU285
 290:tmk_core/common/action_tapping.c ****             debug("\n");
 1091               		.loc 1 290 13 is_stmt 0 view .LVU286
 1092 032e 782D      		mov r23,r8
 1093 0330 998A      		std Y+17,r9
 1094 0332 888A      		std Y+16,r8
 1095 0334 A701      		movw r20,r14
 1096 0336 6C2D      		mov r22,r12
 1097 0338 8989      		ldd r24,Y+17
 1098 033a 0E94 0000 		call debug_event
 1099               	.LVL67:
 291:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1100               		.loc 1 291 24 is_stmt 1 view .LVU287
 292:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 1101               		.loc 1 292 13 view .LVU288
 292:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 1102               		.loc 1 292 25 is_stmt 0 view .LVU289
 1103 033e 86E0      		ldi r24,lo8(6)
 1104 0340 F501      		movw r30,r10
 1105               		0:
 1106 0342 1192      		st Z+,__zero_reg__
 1107 0344 8A95      		dec r24
 1108 0346 01F4      		brne 0b
 293:tmk_core/common/action_tapping.c ****             return false;
 1109               		.loc 1 293 13 is_stmt 1 view .LVU290
 1110 0348 00C0      		rjmp .L121
 1111               	.LVL68:
 1112               	.L29:
 299:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1113               		.loc 1 299 9 view .LVU291
 299:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1114               		.loc 1 299 12 is_stmt 0 view .LVU292
 1115 034a CC20      		tst r12
 1116 034c 01F4      		brne .+2
 1117 034e 00C0      		rjmp .L55
 299:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1118               		.loc 1 299 30 discriminator 1 view .LVU293
 1119 0350 ED86      		std Y+13,r14
 1120 0352 FE86      		std Y+14,r15
 1121 0354 8D85      		ldd r24,Y+13
 1122 0356 9E85      		ldd r25,Y+14
 1123 0358 0E94 0000 		call is_tap_key
 1124               	.LVL69:
 299:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1125               		.loc 1 299 30 discriminator 1 view .LVU294
 1126 035c D82E      		mov r13,r24
 299:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1127               		.loc 1 299 27 discriminator 1 view .LVU295
 1128 035e 8823      		tst r24
 1129 0360 01F4      		brne .+2
 1130 0362 00C0      		rjmp .L55
 300:tmk_core/common/action_tapping.c ****             tapping_key = *keyp;
 1131               		.loc 1 300 54 is_stmt 1 view .LVU296
 301:tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 1132               		.loc 1 301 13 view .LVU297
 301:tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 1133               		.loc 1 301 25 is_stmt 0 view .LVU298
 1134 0364 86E0      		ldi r24,lo8(6)
 1135 0366 F801      		movw r30,r16
 1136 0368 A0E0      		ldi r26,lo8(tapping_key)
 1137 036a B0E0      		ldi r27,hi8(tapping_key)
 1138               		0:
 1139 036c 0190      		ld r0,Z+
 1140 036e 0D92      		st X+,r0
 1141 0370 8A95      		dec r24
 1142 0372 01F4      		brne 0b
 302:tmk_core/common/action_tapping.c ****             waiting_buffer_scan_tap();
 1143               		.loc 1 302 13 is_stmt 1 view .LVU299
 1144 0374 80E0      		ldi r24,lo8(tapping_key)
 1145 0376 90E0      		ldi r25,hi8(tapping_key)
 1146 0378 0E94 0000 		call process_record_tap_hint
 1147               	.LVL70:
 303:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 1148               		.loc 1 303 13 view .LVU300
 1149 037c 0E94 0000 		call waiting_buffer_scan_tap
 1150               	.LVL71:
 1151 0380 00C0      		rjmp .L121
 1152               	.LVL72:
 1153               	.L39:
 1154               	.LBB41:
 1155               	.LBB39:
 1156               		.loc 2 50 79 is_stmt 0 view .LVU301
 1157 0382 81E0      		ldi r24,lo8(1)
 1158 0384 8C25      		eor r24,r12
 1159 0386 00C0      		rjmp .L38
 1160               	.LVL73:
 1161               	.L36:
 1162               		.loc 2 50 79 view .LVU302
 1163               	.LBE39:
 1164               	.LBE41:
 1165               	.LBB42:
 1166               	.LBB34:
 1167 0388 81E0      		ldi r24,lo8(1)
 1168 038a 8C25      		eor r24,r12
 1169 038c 00C0      		rjmp .L35
 1170               	.LBE34:
 1171               	.LBE42:
 1172               		.cfi_endproc
 1173               	.LFE6:
 1175               		.section	.text.get_tapping_term,"ax",@progbits
 1176               		.weak	get_tapping_term
 1178               	get_tapping_term:
 1179               	.LVL74:
 1180               	.LFB4:
  22:tmk_core/common/action_tapping.c **** 
 1181               		.loc 1 22 88 is_stmt 1 view -0
 1182               		.cfi_startproc
 1183               	/* prologue: function */
 1184               	/* frame size = 0 */
 1185               	/* stack size = 0 */
 1186               	.L__stack_usage = 0
  22:tmk_core/common/action_tapping.c **** 
 1187               		.loc 1 22 90 view .LVU304
  22:tmk_core/common/action_tapping.c **** 
 1188               		.loc 1 22 1 is_stmt 0 view .LVU305
 1189 0000 88EC      		ldi r24,lo8(-56)
 1190 0002 90E0      		ldi r25,0
 1191               	.LVL75:
 1192               	/* epilogue start */
  22:tmk_core/common/action_tapping.c **** 
 1193               		.loc 1 22 1 view .LVU306
 1194 0004 0895      		ret
 1195               		.cfi_endproc
 1196               	.LFE4:
 1198               		.section	.text.action_tapping_process,"ax",@progbits
 1199               	.global	action_tapping_process
 1201               	action_tapping_process:
 1202               	.LFB5:
  56:tmk_core/common/action_tapping.c ****     if (process_tapping(&record)) {
 1203               		.loc 1 56 49 is_stmt 1 view -0
 1204               		.cfi_startproc
 1205 0000 1F93      		push r17
 1206               	.LCFI20:
 1207               		.cfi_def_cfa_offset 3
 1208               		.cfi_offset 17, -2
 1209 0002 CF93      		push r28
 1210               	.LCFI21:
 1211               		.cfi_def_cfa_offset 4
 1212               		.cfi_offset 28, -3
 1213 0004 DF93      		push r29
 1214               	.LCFI22:
 1215               		.cfi_def_cfa_offset 5
 1216               		.cfi_offset 29, -4
 1217 0006 CDB7      		in r28,__SP_L__
 1218 0008 DEB7      		in r29,__SP_H__
 1219               	.LCFI23:
 1220               		.cfi_def_cfa_register 28
 1221 000a 2C97      		sbiw r28,12
 1222               	.LCFI24:
 1223               		.cfi_def_cfa_offset 17
 1224 000c 0FB6      		in __tmp_reg__,__SREG__
 1225 000e F894      		cli
 1226 0010 DEBF      		out __SP_H__,r29
 1227 0012 0FBE      		out __SREG__,__tmp_reg__
 1228 0014 CDBF      		out __SP_L__,r28
 1229               	/* prologue: function */
 1230               	/* frame size = 12 */
 1231               	/* stack size = 15 */
 1232               	.L__stack_usage = 15
 1233 0016 4F83      		std Y+7,r20
 1234 0018 5887      		std Y+8,r21
 1235 001a 6987      		std Y+9,r22
 1236 001c 7A87      		std Y+10,r23
 1237 001e 8B87      		std Y+11,r24
 1238 0020 9C87      		std Y+12,r25
  57:tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1239               		.loc 1 57 5 view .LVU308
  57:tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1240               		.loc 1 57 9 is_stmt 0 view .LVU309
 1241 0022 CE01      		movw r24,r28
 1242 0024 0796      		adiw r24,7
 1243 0026 0E94 0000 		call process_tapping
 1244               	.LVL76:
  57:tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1245               		.loc 1 57 8 view .LVU310
 1246 002a 8823      		tst r24
 1247 002c 01F0      		breq .L128
  58:tmk_core/common/action_tapping.c ****             debug("processed: ");
 1248               		.loc 1 58 9 is_stmt 1 view .LVU311
 1249               	.LBB51:
 1250               	.LBI51:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1251               		.loc 2 48 20 view .LVU312
 1252               	.LBB52:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1253               		.loc 2 48 51 view .LVU313
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1254               		.loc 2 48 74 is_stmt 0 view .LVU314
 1255 002e 8A85      		ldd r24,Y+10
 1256 0030 9B85      		ldd r25,Y+11
 1257 0032 892B      		or r24,r25
 1258 0034 01F0      		breq .L129
 1259 0036 4F81      		ldd r20,Y+7
 1260 0038 5885      		ldd r21,Y+8
 1261 003a 842F      		mov r24,r20
 1262 003c 8523      		and r24,r21
 1263 003e 8F3F      		cpi r24,lo8(-1)
 1264 0040 01F0      		breq .+2
 1265 0042 00C0      		rjmp .L151
 1266               	.L129:
 1267               	.LBE52:
 1268               	.LBE51:
  78:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer[");
 1269               		.loc 1 78 13 discriminator 1 view .LVU315
 1270 0044 16E0      		ldi r17,lo8(6)
 1271 0046 00C0      		rjmp .L136
 1272               	.L128:
  64:tmk_core/common/action_tapping.c ****             // clear all in case of overflow.
 1273               		.loc 1 64 9 is_stmt 1 view .LVU316
 1274 0048 86E0      		ldi r24,lo8(6)
 1275 004a FE01      		movw r30,r28
 1276 004c 3796      		adiw r30,7
 1277 004e DE01      		movw r26,r28
 1278 0050 1196      		adiw r26,1
 1279               		0:
 1280 0052 0190      		ld r0,Z+
 1281 0054 0D92      		st X+,r0
 1282 0056 8A95      		dec r24
 1283 0058 01F4      		brne 0b
 1284               	.LVL77:
 1285               	.LBB53:
 1286               	.LBI53:
 317:tmk_core/common/action_tapping.c ****     if (IS_NOEVENT(record.event)) {
 1287               		.loc 1 317 6 view .LVU317
 1288               	.LBB54:
 318:tmk_core/common/action_tapping.c ****         return true;
 1289               		.loc 1 318 5 view .LVU318
 1290               	.LBB55:
 1291               	.LBI55:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1292               		.loc 2 48 20 view .LVU319
 1293               	.LBB56:
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1294               		.loc 2 48 51 view .LVU320
  48:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1295               		.loc 2 48 74 is_stmt 0 view .LVU321
 1296 005a 8A85      		ldd r24,Y+10
 1297 005c 9B85      		ldd r25,Y+11
 1298 005e 892B      		or r24,r25
 1299 0060 01F0      		breq .L129
 1300 0062 8F81      		ldd r24,Y+7
 1301 0064 9885      		ldd r25,Y+8
 1302 0066 8923      		and r24,r25
 1303 0068 8F3F      		cpi r24,lo8(-1)
 1304 006a 01F0      		breq .L129
 1305               	.LBE56:
 1306               	.LBE55:
 322:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1307               		.loc 1 322 5 is_stmt 1 view .LVU322
 322:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1308               		.loc 1 322 30 is_stmt 0 view .LVU323
 1309 006c 2091 0000 		lds r18,waiting_buffer_head
 1310 0070 30E0      		ldi r19,0
 1311 0072 C901      		movw r24,r18
 1312 0074 0196      		adiw r24,1
 322:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1313               		.loc 1 322 35 view .LVU324
 1314 0076 8770      		andi r24,7
 1315 0078 9927      		clr r25
 322:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1316               		.loc 1 322 57 view .LVU325
 1317 007a 4091 0000 		lds r20,waiting_buffer_tail
 322:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1318               		.loc 1 322 8 view .LVU326
 1319 007e 4817      		cp r20,r24
 1320 0080 1906      		cpc __zero_reg__,r25
 1321 0082 01F4      		brne .L153
 1322               	.LVL78:
 322:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1323               		.loc 1 322 8 view .LVU327
 1324               	.LBE54:
 1325               	.LBE53:
  66:tmk_core/common/action_tapping.c ****             clear_keyboard();
 1326               		.loc 1 66 50 is_stmt 1 view .LVU328
  67:tmk_core/common/action_tapping.c ****             waiting_buffer_clear();
 1327               		.loc 1 67 13 view .LVU329
 1328 0084 0E94 0000 		call clear_keyboard
 1329               	.LVL79:
  68:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1330               		.loc 1 68 13 view .LVU330
 1331               	.LBB58:
 1332               	.LBI58:
 339:tmk_core/common/action_tapping.c ****     waiting_buffer_head = 0;
 1333               		.loc 1 339 6 view .LVU331
 1334               	.LBB59:
 340:tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 1335               		.loc 1 340 5 view .LVU332
 340:tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 1336               		.loc 1 340 25 is_stmt 0 view .LVU333
 1337 0088 1092 0000 		sts waiting_buffer_head,__zero_reg__
 341:tmk_core/common/action_tapping.c **** }
 1338               		.loc 1 341 5 is_stmt 1 view .LVU334
 341:tmk_core/common/action_tapping.c **** }
 1339               		.loc 1 341 25 is_stmt 0 view .LVU335
 1340 008c 1092 0000 		sts waiting_buffer_tail,__zero_reg__
 1341               	.LBE59:
 1342               	.LBE58:
  69:tmk_core/common/action_tapping.c ****         }
 1343               		.loc 1 69 13 is_stmt 1 view .LVU336
  69:tmk_core/common/action_tapping.c ****         }
 1344               		.loc 1 69 25 is_stmt 0 view .LVU337
 1345 0090 86E0      		ldi r24,lo8(6)
 1346 0092 E0E0      		ldi r30,lo8(tapping_key)
 1347 0094 F0E0      		ldi r31,hi8(tapping_key)
 1348 0096 DF01      		movw r26,r30
 1349               		0:
 1350 0098 1D92      		st X+,__zero_reg__
 1351 009a 8A95      		dec r24
 1352 009c 01F4      		brne 0b
 1353 009e 00C0      		rjmp .L129
 1354               	.LVL80:
 1355               	.L153:
 1356               	.LBB60:
 1357               	.LBB57:
 327:tmk_core/common/action_tapping.c ****     waiting_buffer_head                 = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1358               		.loc 1 327 5 is_stmt 1 view .LVU338
 327:tmk_core/common/action_tapping.c ****     waiting_buffer_head                 = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1359               		.loc 1 327 41 is_stmt 0 view .LVU339
 1360 00a0 96E0      		ldi r25,lo8(6)
 1361               	.LVL81:
 327:tmk_core/common/action_tapping.c ****     waiting_buffer_head                 = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1362               		.loc 1 327 41 view .LVU340
 1363 00a2 929F      		mul r25,r18
 1364 00a4 D001      		movw r26,r0
 1365 00a6 939F      		mul r25,r19
 1366 00a8 B00D      		add r27,r0
 1367 00aa 1124      		clr __zero_reg__
 1368 00ac A050      		subi r26,lo8(-(waiting_buffer))
 1369 00ae B040      		sbci r27,hi8(-(waiting_buffer))
 1370 00b0 FE01      		movw r30,r28
 1371 00b2 3196      		adiw r30,1
 1372               		0:
 1373 00b4 0190      		ld r0,Z+
 1374 00b6 0D92      		st X+,r0
 1375 00b8 9A95      		dec r25
 1376 00ba 01F4      		brne 0b
 328:tmk_core/common/action_tapping.c **** 
 1377               		.loc 1 328 5 is_stmt 1 view .LVU341
 328:tmk_core/common/action_tapping.c **** 
 1378               		.loc 1 328 41 is_stmt 0 view .LVU342
 1379 00bc 8093 0000 		sts waiting_buffer_head,r24
 330:tmk_core/common/action_tapping.c ****     debug_waiting_buffer();
 1380               		.loc 1 330 34 is_stmt 1 view .LVU343
 331:tmk_core/common/action_tapping.c ****     return true;
 1381               		.loc 1 331 5 view .LVU344
 1382 00c0 0E94 0000 		call debug_waiting_buffer
 1383               	.LVL82:
 332:tmk_core/common/action_tapping.c **** }
 1384               		.loc 1 332 5 view .LVU345
 332:tmk_core/common/action_tapping.c **** }
 1385               		.loc 1 332 5 is_stmt 0 view .LVU346
 1386 00c4 00C0      		rjmp .L129
 1387               	.L134:
 332:tmk_core/common/action_tapping.c **** }
 1388               		.loc 1 332 5 view .LVU347
 1389               	.LBE57:
 1390               	.LBE60:
  78:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer[");
 1391               		.loc 1 78 9 is_stmt 1 view .LVU348
  78:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer[");
 1392               		.loc 1 78 13 is_stmt 0 view .LVU349
 1393 00c6 819F      		mul r24,r17
 1394 00c8 C001      		movw r24,r0
 1395 00ca 1124      		clr __zero_reg__
 1396 00cc 8050      		subi r24,lo8(-(waiting_buffer))
 1397 00ce 9040      		sbci r25,hi8(-(waiting_buffer))
 1398 00d0 0E94 0000 		call process_tapping
 1399               	.LVL83:
  78:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer[");
 1400               		.loc 1 78 12 view .LVU350
 1401 00d4 8823      		tst r24
 1402 00d6 01F0      		breq .L127
  79:tmk_core/common/action_tapping.c ****             debug_dec(waiting_buffer_tail);
 1403               		.loc 1 79 48 is_stmt 1 view .LVU351
  80:tmk_core/common/action_tapping.c ****             debug("] = ");
 1404               		.loc 1 80 43 view .LVU352
  81:tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]);
 1405               		.loc 1 81 26 view .LVU353
  82:tmk_core/common/action_tapping.c ****             debug("\n\n");
 1406               		.loc 1 82 13 view .LVU354
 1407 00d8 E091 0000 		lds r30,waiting_buffer_tail
 1408 00dc 1E9F      		mul r17,r30
 1409 00de F001      		movw r30,r0
 1410 00e0 1124      		clr __zero_reg__
 1411 00e2 E050      		subi r30,lo8(-(waiting_buffer))
 1412 00e4 F040      		sbci r31,hi8(-(waiting_buffer))
 1413 00e6 4081      		ld r20,Z
 1414 00e8 5181      		ldd r21,Z+1
 1415 00ea 6281      		ldd r22,Z+2
 1416 00ec 7381      		ldd r23,Z+3
 1417 00ee 8481      		ldd r24,Z+4
 1418 00f0 9581      		ldd r25,Z+5
 1419 00f2 0E94 0000 		call debug_record
 1420               	.LVL84:
  83:tmk_core/common/action_tapping.c ****         } else {
 1421               		.loc 1 83 26 view .LVU355
  77:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1422               		.loc 1 77 56 view .LVU356
  77:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1423               		.loc 1 77 99 is_stmt 0 view .LVU357
 1424 00f6 8091 0000 		lds r24,waiting_buffer_tail
 1425 00fa 90E0      		ldi r25,0
 1426 00fc 0196      		adiw r24,1
  77:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1427               		.loc 1 77 104 view .LVU358
 1428 00fe 8770      		andi r24,7
 1429 0100 9927      		clr r25
  77:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1430               		.loc 1 77 76 view .LVU359
 1431 0102 8093 0000 		sts waiting_buffer_tail,r24
 1432               	.L136:
  77:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1433               		.loc 1 77 12 is_stmt 1 discriminator 1 view .LVU360
  77:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1434               		.loc 1 77 32 is_stmt 0 discriminator 1 view .LVU361
 1435 0106 8091 0000 		lds r24,waiting_buffer_tail
  77:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1436               		.loc 1 77 5 discriminator 1 view .LVU362
 1437 010a 9091 0000 		lds r25,waiting_buffer_head
 1438 010e 8913      		cpse r24,r25
 1439 0110 00C0      		rjmp .L134
 1440               	.L127:
 1441               	/* epilogue start */
  91:tmk_core/common/action_tapping.c **** 
 1442               		.loc 1 91 1 view .LVU363
 1443 0112 2C96      		adiw r28,12
 1444 0114 0FB6      		in __tmp_reg__,__SREG__
 1445 0116 F894      		cli
 1446 0118 DEBF      		out __SP_H__,r29
 1447 011a 0FBE      		out __SREG__,__tmp_reg__
 1448 011c CDBF      		out __SP_L__,r28
 1449 011e DF91      		pop r29
 1450 0120 CF91      		pop r28
 1451 0122 1F91      		pop r17
 1452 0124 0895      		ret
 1453               	.L151:
  59:tmk_core/common/action_tapping.c ****             debug_record(record);
 1454               		.loc 1 59 33 is_stmt 1 view .LVU364
  60:tmk_core/common/action_tapping.c ****             debug("\n");
 1455               		.loc 1 60 13 view .LVU365
 1456 0126 6985      		ldd r22,Y+9
 1457 0128 7A85      		ldd r23,Y+10
 1458 012a 8B85      		ldd r24,Y+11
 1459 012c 9C85      		ldd r25,Y+12
 1460 012e 0E94 0000 		call debug_record
 1461               	.LVL85:
 1462 0132 00C0      		rjmp .L129
 1463               		.cfi_endproc
 1464               	.LFE5:
 1466               		.section	.bss.waiting_buffer_tail,"aw",@nobits
 1469               	waiting_buffer_tail:
 1470 0000 00        		.zero	1
 1471               		.section	.bss.waiting_buffer_head,"aw",@nobits
 1474               	waiting_buffer_head:
 1475 0000 00        		.zero	1
 1476               		.section	.bss.waiting_buffer,"aw",@nobits
 1479               	waiting_buffer:
 1480 0000 0000 0000 		.zero	48
 1480      0000 0000 
 1480      0000 0000 
 1480      0000 0000 
 1480      0000 0000 
 1481               		.section	.bss.tapping_key,"aw",@nobits
 1484               	tapping_key:
 1485 0000 0000 0000 		.zero	6
 1485      0000 
 1486               		.text
 1487               	.Letext0:
 1488               		.file 3 "/usr/local/Cellar/avr-gcc@8/8.4.0/avr/include/stdint.h"
 1489               		.file 4 "tmk_core/common/keycode.h"
 1490               		.file 5 "tmk_core/common/action_code.h"
 1491               		.file 6 "tmk_core/common/action.h"
 1492               		.file 7 "tmk_core/common/action_layer.h"
 1493               		.file 8 "tmk_core/common/timer.h"
 1494               		.file 9 "tmk_core/common/avr/xprintf.h"
 1495               		.file 10 "tmk_core/common/debug.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 action_tapping.c
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:2      *ABS*:000000000000003e __SP_H__
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:3      *ABS*:000000000000003d __SP_L__
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:4      *ABS*:000000000000003f __SREG__
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:5      *ABS*:0000000000000000 __tmp_reg__
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:6      *ABS*:0000000000000001 __zero_reg__
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:12     .text.debug_waiting_buffer:0000000000000000 debug_waiting_buffer
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:1469   .bss.waiting_buffer_tail:0000000000000000 waiting_buffer_tail
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:1474   .bss.waiting_buffer_head:0000000000000000 waiting_buffer_head
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:1479   .bss.waiting_buffer:0000000000000000 waiting_buffer
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:96     .text.debug_tapping_key:0000000000000000 debug_tapping_key
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:1484   .bss.tapping_key:0000000000000000 tapping_key
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:119    .text.waiting_buffer_typed.isra.1:0000000000000000 waiting_buffer_typed.isra.1
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:194    .text.waiting_buffer_scan_tap:0000000000000000 waiting_buffer_scan_tap
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:357    .text.process_tapping:0000000000000000 process_tapping
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:1178   .text.get_tapping_term:0000000000000000 get_tapping_term
/var/folders/7y/kbn66ztx1rs80r6yv6v16f4r0000gn/T//ccOQOLur.s:1201   .text.action_tapping_process:0000000000000000 action_tapping_process

UNDEFINED SYMBOLS
debug_record
process_record
layer_switch_get_action
is_tap_key
debug_event
process_record_tap_hint
clear_keyboard
__do_clear_bss
